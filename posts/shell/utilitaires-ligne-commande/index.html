<!doctype html><html lang="fr" class="r-VerticalRhythm"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui"><title>Les utilitaires en ligne de commande</title><link rel="stylesheet" href="/index.css"><link rel="alternate" href="/feed.xml" title="Les utilitaires en ligne de commande" type="application/atom+xml"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@putaindecode"><meta name="twitter:title" content="Les utilitaires en ligne de commande"><meta name="twitter:creator" content="@magsout"><meta property="og:title" content="Les utilitaires en ligne de commande"><meta property="og:type" content="article"><meta property="og:site_name" content="Putain de code !"></head><body><div class="putainde-Header"><div class="r-Grid"><div class="r-Grid-cell r-all--5of12"><a class="putainde-SiteTitle" href="/"><img class="putainde-Logo" alt="Putain de code !" src="/images/p!-logo.svg"><span>Putain de code !</span></a></div><div class="r-Grid-cell r-all--7of12"><nav class="putainde-Nav"><a class="putainde-Nav-item" href="/posts" data-r-tooltip=""><img class="putainde-Icon" src="/icons/bookmark.svg">Articles</a><a class="putainde-Nav-item" href="/c-est-quoi-putaindecode" data-r-tooltip=""><img class="putainde-Icon" src="/icons/text-file.svg">Readme</a><a class="putainde-Nav-item" href="/posts/comment-contribuer" data-r-tooltip=""><img class="putainde-Icon" src="/icons/pencil.svg">Participer</a><a class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" href="https://github.com/putaindecode/" data-r-tooltip="GitHub"><img class="putainde-Icon" src="/icons/github.svg"></a><a class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip r-Tooltip--bottom" href="https://twitter.com/putaindecode/" data-r-tooltip="Twitter"><img class="putainde-Icon" src="/icons/twitter.svg"></a></nav></div></div></div><div class="putainde-Main"><article class="putainde-Post"><header><div class="putainde-Post-header"><h1 class="putainde-Title">Les utilitaires en ligne de commande</h1></div><div class="putainde-Post-metas"><span>Écrit par <span><a href="http://magsout.github.io/">magsout</a><span></span></span></span><span>, </span><span class="putainde-Date"> le 12 mai 2015</span>. <span class="r-Tooltip r-Tooltip--top putainde-Post-readingTime" data-r-tooltip="Temps de lecture approximatif, sur une base de 250 mots par minute">Temps de lecture : environ 5 minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">cli</li><li class="putainde-Tag">npm</li><li class="putainde-Tag">iojs/nodejs</li></ul></header><div class="r-Grid"><div class="r-Grid-cell r-all--8of12 putainde-Post-contents"><div class="putainde-Post-md"><div><p>Avoir accès à ses utilitaires en ligne de commande (<a href="https://en.wikipedia.org/wiki/Command-line_interface" >CLI</a>) est un quotidien dans nos métiers et un avantage indéniable. Ce n’est pas nouveau et cela existe depuis la nuit des temps. Tout utilisateur
d’Unix voue un culte particulier à son terminal.</p>
<p>J’ai récemment eu à développer un utilitaire en Node.js/iojs, j’ai donc voulu avec cet article déblayer un peu le terrain
et présenter quelques utilitaires très pratiques.</p>
<p>Deux postulats avant de commencer :</p>
<ul>
<li>Pourquoi JavaScript ? En cohérence avec le workflow que j’utilise.</li>
<li>Cet article n’a pas pour but d’apprendre à écrire du JavaScript avec Node.js/iojs.</li>
</ul>
<h2 id="hello-world">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#hello-world">#</a>
      Hello world
    </h2><p>Avant de commencer à coder, il va tout d’abord falloir créer deux fichiers qui seront nécessaires et obligatoires :</p>
<pre><code class="lang-console"><span class="hljs-comment">// création du dossier</span>
$ <span class="hljs-keyword">mkdir</span> putaindecode-<span class="hljs-keyword">cli</span> &amp;&amp; <span class="hljs-keyword">cd</span> putaindecode-<span class="hljs-keyword">cli</span>

<span class="hljs-comment">// création de index.js</span>
$ touch index.js

<span class="hljs-comment">// création de package.json</span>
$ touch package.json
</code></pre>
<p>Le fichier <code>index.js</code> va se présenter comme ceci :</p>
<pre><code><span class="hljs-shebang">#!/usr/bin/env node</span>
<span class="hljs-comment">// Cette ligne ou shebang permet de définir l'interpréteur de notre script, à savoir `node`</span>

<span class="hljs-comment">// notre fameux hello world</span>
console.log(<span class="hljs-string">"Hello world"</span>)
</code></pre><p>Pour notre fichier <code>package.json</code>, deux méthodes possibles pour l’écrire, soit en faisant <code>npm init</code> puis suivre les instructions, soit adapter ce JSON :</p>
<pre><code class="lang-console">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"putaindecode-cli"</span></span>,
  "<span class="hljs-attribute">version</span>": <span class="hljs-value"><span class="hljs-string">"0.1.0"</span></span>,
  "<span class="hljs-attribute">description</span>": <span class="hljs-value"><span class="hljs-string">"Putaindecode cli"</span></span>,
  "<span class="hljs-attribute">keywords</span>": <span class="hljs-value">[
    <span class="hljs-string">"cli"</span>,
    <span class="hljs-string">"npm"</span>
  ]</span>,
  "<span class="hljs-attribute">author</span>": <span class="hljs-value"><span class="hljs-string">"magsout"</span></span>,
  "<span class="hljs-attribute">license</span>": <span class="hljs-value"><span class="hljs-string">"MIT"</span></span>,
  "<span class="hljs-attribute">repository</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"git"</span></span>,
    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode/putaindecode-cli.git"</span>
  </span>}</span>,
  "<span class="hljs-attribute">engines</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">node</span>": <span class="hljs-value"><span class="hljs-string">"&gt;=0.10"</span>
  </span>}</span>,
  "<span class="hljs-attribute">homepage</span>":<span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode-cs/putaindecode-cli"</span>
  <span class="hljs-string">"bugs"</span>: {
    "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/putaindecode-cs/putaindecode-cli/issues"</span>
  </span>}</span>,
  "<span class="hljs-attribute">files</span>": <span class="hljs-value">[
    <span class="hljs-string">"index.js"</span>
  ]</span>,
  "<span class="hljs-attribute">dependencies</span>": <span class="hljs-value">{}</span>,
  "<span class="hljs-attribute">devDependencies</span>": <span class="hljs-value">{}</span>,
  "<span class="hljs-attribute">bin</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">putaindecode</span>": <span class="hljs-value"><span class="hljs-string">"index.js"</span>
  </span>}
</span>}
</code></pre>
<p>La ligne importante à ne surtout pas oublier :</p>
<pre><code class="lang-console"><span class="hljs-string">"bin"</span>: {
  <span class="hljs-string">"putaindecode-cli"</span>: <span class="hljs-string">"index.js"</span>
}
</code></pre>
<p>Elle permettra de déterminer le script à exécuter lorsque la commande <code>putaindecode-cli</code> sera lancée.</p>
<p>Si on vulgarise un peu le principe, en installant le script, le fichier <code>index.js</code> sera renommé en <code>putaindecode-cli.js</code> et sera copié dans le répertoire adéquat (cela dépend de l’OS).</p>
<p>Lorsque la commande <code>putaindecode-cli</code> sera exécutée, le shell va chercher le fichier exécutable en utilisant les répertoires listés dans la variable PATH.</p>
<p>Si on suit ce raisonnement, l’installation d’un script écrasera automatiquement l’ancienne version ou tout script de même nom.</p>
<p>Pour s’assurer qu’il n’existe pas d’autres commandes portant le même nom, il est conseillé d’utiliser la commande : <code>which putaindecode-cli</code> qui ne retournera rien s’il n’y a aucun résultat :</p>
<pre><code class="lang-console">#putaindecode-<span class="hljs-keyword">cli</span> ne retourne aucun résultat
$ <span class="hljs-keyword">which</span> putaindecode-<span class="hljs-keyword">cli</span>

#node <span class="hljs-keyword">est</span> installé et accessible au path suivant
$ <span class="hljs-keyword">which</span> node
  /usr/<span class="hljs-keyword">local</span>/bin/node
</code></pre>
<h2 id="installation-du-script">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#installation-du-script">#</a>
      Installation du script
    </h2><p>Afin de vérifier que le script fonctionne correctement, il suffit tout simplement d’exécuter dans le répertoire la commande : <code>./index.js</code>.</p>
<p>Une erreur de droit ? Un petit chmod pour arranger ça : <code>chmod +x index.js</code>.</p>
<p>À ce stade, si tout fonctionne bien, <code>Hello World</code> va s’afficher.</p>
<p>Par contre, exécuter notre script de la sorte n’est pas très pratique, d’autant plus qu’il sera nécessaire de connaître à chaque fois le chemin vers le fichier.</p>
<p>Il serait beaucoup plus simple de pouvoir exécuter le script comme une commande. Comme pour tout package npm, cela se fait avec <code>npm install</code>.</p>
<pre><code class="lang-console"><span class="hljs-comment">// installation en global du script</span>
$ npm install -<span class="hljs-keyword">g</span>

<span class="hljs-comment">// exécution de la commande</span>
$ putaindecode-<span class="hljs-keyword">cli</span>

<span class="hljs-comment">// résultat de la commande</span>
Hello world
</code></pre>
<p>Le script est maintenant accessible partout sur l’OS grâce à la commande <code>putaindecode-cli</code>. L’installation en global n’est pas absolument pas nécessaire, tout dépend de l’intérêt de votre script. Il est d’ailleurs souvent préférable de l’installer en local dans un projet avec <code>--save</code> ou <code>--save-dev</code>.</p>
<h2 id="installation-des-scripts-de-base">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#installation-des-scripts-de-base">#</a>
      Installation des scripts de base
    </h2><p>La puissance de <code>NPM</code> provient de son nombre impressionnant de packages mis à disposition.</p>
<p>Pour gagner du temps et éviter d’avoir à recoder la roue. Le script <code>putaindecode-cli</code> va avoir besoin de trois choses :</p>
<ul>
<li>une gestion des commandes (commande, argument, aide)</li>
<li>une gestion des couleurs (notice, error, warning)</li>
<li>une capacité à stopper proprement notre code.</li>
</ul>
<h3 id="commander">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#commander">#</a>
      <code>commander</code>
    </h3><p>Pour les commandes avec en prime la gestion des arguments et de l’aide, <a href="https://github.com/tj/commander" >commander</a> est tout a fait adapté et répondra pratiquement à tous nos besoins.</p>
<p>Il est simple d’utilisation et très bien maintenu.</p>
<p>Voici un exemple de ce qu’on peut faire :</p>
<pre><code class="lang-js"><span class="hljs-comment">/* Default */</span>
program
  .version(pkg.version)

<span class="hljs-comment">/* command */</span>
program
  .command(<span class="hljs-string">"command"</span>)
  .alias(<span class="hljs-string">'c'</span>)
  .description(<span class="hljs-string">"   command does something"</span>)
  .option(<span class="hljs-string">"-v, --verbose"</span>, <span class="hljs-string">"Verbose"</span>)
  .option(<span class="hljs-string">"-f, --force"</span>, <span class="hljs-string">"Force installation"</span>)
  .action(commandAction)
  .on(<span class="hljs-string">"--help"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"  Example:"</span>)
    <span class="hljs-built_in">console</span>.log();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     command does something"</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command"</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
  });

<span class="hljs-comment">/* help */</span>
program.on(<span class="hljs-string">"--help"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"  Examples:"</span>)
  <span class="hljs-built_in">console</span>.log();
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     command do something"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     Force command does something"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"     $ putaindecode-cli command -f"</span>)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>)
});

program.parse(process.argv)

<span class="hljs-comment">/* help by default */</span>
<span class="hljs-keyword">if</span> (!program.args.length) program.help()
</code></pre>
<h3 id="chalk">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#chalk">#</a>
      <code>chalk</code>
    </h3><p><em>Null</em> besoin de faire un cours sur les couleurs, mais l’affichage d’une notice est bien plus pertinent avec sa couleur associée. C’est à ce moment qu’entre en jeu <a href="https://github.com/sindresorhus/chalk" >chalk</a>. Relativement simple à mettre en place et à utiliser :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chalk'</span>)

<span class="hljs-comment">/* var */</span>
<span class="hljs-keyword">var</span> error   = chalk.bold.red
<span class="hljs-keyword">var</span> warn    = chalk.yellow
<span class="hljs-keyword">var</span> success = chalk.green
<span class="hljs-keyword">var</span> notice  = chalk.blue

<span class="hljs-comment">/* code */</span>
<span class="hljs-built_in">console</span>.log(warn(<span class="hljs-string">'No command'</span>))
<span class="hljs-built_in">console</span>.log(notice(<span class="hljs-string">"file modified !"</span>))
</code></pre>
<h3 id="exit">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#exit">#</a>
      <code>exit</code>
    </h3><p>Peu importe comment s’exécute son code, il est important de bien savoir maitriser l’arrêt de son script. Pour ça, <code>process.exit()</code> nous sera bien utile.</p>
<p>Dans le cas d’une erreur, la valeur de <code>exit</code> doit systématiquement être supérieure à 0, et donc bien naturellement en cas de succès, elle doit être égale à 0.</p>
<p>Voici une <a href="http://www.virtsync.com/c-error-codes-include-errno" >liste des valeurs</a> de <code>exit</code> et de leurs correspondances.</p>
<h2 id="thanks-god-for-our-terminal">
      <a class="putainde-Title-anchor" href="http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/#thanks-god-for-our-terminal">#</a>
      Thanks god for our terminal
    </h2><p>Si vous souhaitez voir quelques exemples de projets avec des commandes et des mises en situations intéressantes, allez faire un tour sur ces projets :</p>
<ul>
<li><a href="https://github.com/cssnext/cssnext/blob/master/bin/cssnext.js" >cssnext</a></li>
<li><a href="https://github.com/sindresorhus/trash/blob/master/cli.js" >trash</a></li>
</ul>
<p>Je vous invite également à visionner la <a href="http://blog.clement.delafargue.name/posts/2015-02-25-declarative-cli-parsing-in-js.html" >vidéo</a> de <a href="https://twitter.com/clementd" >Clement Delafargue</a> qui a fait une présentation sur le sujet en début d’année.</p>
<p>À partir de là on dispose d’une bonne base pour refaire le monde et accroître la flemme du développeur que l’on est en automatisant tout plein de tâches.</p>
</div></div><footer class="putainde-Post-footer"><div><div class="putainde-Author undefined"><a href="http://magsout.github.io/" class="putainde-Avatar putainde-Author-picture"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1997108?v=3&amp;s=128" alt=""></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par </span><a class="putainde-Link" href="http://magsout.github.io/">magsout</a></h3><div class="putainde-Author-social"><a href="http://magsout.github.io/" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Website"><img class="putainde-Icon" src="/icons/home.svg"></a><a href="https://twitter.com/magsout" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Twitter"><img class="putainde-Icon" src="/icons/twitter.svg"></a><a href="https://github.com/magsout" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Github"><img class="putainde-Icon" src="/icons/github.svg"></a></div></div><p class="putainde-Author-bio">Développeur web front-end pour l&#x27;agence web @splitfire. Adore chasser les bugs la nuit, accro aux series-tv.</p></div></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">4 contributeurs sur cette page</strong><div class="r-Grid putainde-Contributors-actions"><div class="r-Grid-cell r-all--1of3"><a class="putainde-Contributors-action" href="http://github.com/putaindecode/putaindecode.fr/edit/master/content/posts/shell/utilitaires-ligne-commande/index.md">Modifier</a></div><div class="r-Grid-cell r-all--1of3"><a class="putainde-Contributors-action" href="http://github.com/putaindecode/putaindecode.fr/blame/master/content/posts/shell/utilitaires-ligne-commande/index.md">Tracer les changements</a></div><div class="r-Grid-cell r-all--1of3"><a class="putainde-Contributors-action" href="http://github.com/putaindecode/putaindecode.fr/commits/master/content/posts/shell/utilitaires-ligne-commande/index.md">Historique</a></div></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="MoOx
(2 commits)"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt=""></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="magsout
(2 commits)"><a href="http://magsout.github.io/" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1997108?v=3&amp;s=128" alt=""></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="lionelB
(1 commit)"><a href="http://lumographe.fr/" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/160320?v=3&amp;s=128" alt=""></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Macxim
(1 commit)"><a href="https://github.com/Macxim" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1909957?v=3&amp;s=128" alt=""></a></div></div><div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></footer></div></div></article></div><div class="putainde-Footer"><div class="r-Grid"><div class="r-Grid-cell r-all--3of12"><p class="putainde-Footer-text">© 1970 - 2015 Putain de code !</p></div><div class="r-Grid-cell r-all--6of12"><ul class="putainde-Footer-list"><li><a href="/feed.xml">Flux RSS</a></li><li><a href="/projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><li><a href="https://github.com/putaindecode/" data-r-tooltip="GitHub" class="r-Tooltip r-Tooltip--top"><img class="putainde-Icon" src="/icons/github.svg"></a></li><li><a href="https://twitter.com/putaindecode/" data-r-tooltip="Twitter" class="r-Tooltip r-Tooltip--top"><img class="putainde-Icon" src="/icons/twitter.svg"></a></li></ul></div><div class="r-Grid-cell r-all--3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎</p></div></div></div><script src="/index.394cc72.js"></script><script>var _gaq=[["_setAccount","UA-43771806-1"],["_trackPageview"]];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src="//www.google-analytics.com/ga.js";s.parentNode.insertBefore(g,s)}(document,"script"));</script><script>var disqus_shortname = "putaindecode";
var disqus_identifier = "http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/";
var disqus_url = "http://putaindecode.fr/posts/shell/utilitaires-ligne-commande/";
var disqus_script = "embed.js";
(function(d,s) {
  s = d.createElement('script');s.async=1;
  s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
  (d.getElementsByTagName('head')[0]).appendChild(s)
})(document)
    </script></body></html>