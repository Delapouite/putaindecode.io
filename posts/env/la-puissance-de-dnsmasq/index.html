<!DOCTYPE html><html lang="fr" class="cssr-VerticalRhythm"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui"><title>La puissance de dnsmasq</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@putaindecode"/><meta name="twitter:title" content="La puissance de dnsmasq"/><meta name="twitter:creator" content="@_kud"/><meta property="og:title" content="La puissance de dnsmasq"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Putain de code !"/><link rel="stylesheet" href="../../../stylesheets/index.css"><link rel="alternate" href="../../../feed.xml" title="Putain de code !" type="application/atom+xml"></head><body><svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="putainde-Icon-bookmark" viewBox="0 0 512 512">
      <title>bookmark icon</title>
      <path d="M318.275 90v283.23L256 318.16l-62.275 55.07V90h124.55m40-40h-204.55v412L256 371.557 358.275 462V50z"/>
    </symbol>

    <symbol id="putainde-Icon-github" viewBox="0 0 512 512">
      <title>github icon</title>
      <path d="M461.633 250.645l.367-3.82c-22.896-2.22-45.667-2.418-67.79-.73 3.557-11.346 5.43-24.163 5.295-38.738-.292-30.965-10.616-55.08-26.843-75.096 3.116-18.85.77-37.7-5.11-56.56-23.188 1.898-44.054 9.493-62.635 22.686-34.725-7.044-69.447-7.493-104.172 0-21.673-14.627-42.956-21.802-63.91-22.686-6.21 20.765-7.168 41.233-1.916 61.357-18.28 19.397-25.27 42.944-24.926 69.02.196 14.926 2.496 28.208 6.738 39.95-21.796-1.598-44.2-1.385-66.732.8l.367 3.818c22.947-2.228 45.76-2.41 67.92-.678.813 1.974 1.632 3.94 2.566 5.815-24.01-.633-45.618 1.453-65.854 6.43l.913 3.723c20.538-5.048 42.54-7.08 67.107-6.254 16.246 28.865 47.52 45.825 93.063 51.206-10.58 8.594-16.27 18.73-17.735 30.2h-24.12c-32.395 0-41.227-41.303-74.78-37.228C132 320 125.5 371.598 177.588 371.598h21.88v47.297c.234 7.643-3.093 12.754-8.47 16.297 18.655 1.884 32.675-7.43 32.675-18.854V353.82l5.833-6v72.992c.245 7.265-3.284 11.392-7.03 15.34 16.433.653 31.89-2.63 32.59-16.616V349.68s5.757-3.6 5.757 0v66.58c.17 11.8 10.36 21.366 31.953 19.892-5.776-4.65-7.55-9.35-7.55-16.15v-72.18s5.95-.307 5.95 6v60.88c0 13.55 16.268 19.14 34.83 18.615-6.08-4.558-10.196-9.99-10.223-17.256v-73.216c-.63-10.762-5.003-20.906-13.582-30.358 41.63-6.392 71.638-23.01 86.58-52.796 24.646-.847 46.714 1.183 67.306 6.246l.914-3.723c-20.394-5.014-42.18-7.096-66.416-6.415.84-1.89 1.67-3.79 2.39-5.785 22.39-1.798 45.457-1.622 68.66.632zM114 310.023c-1.023 0-1.853-.588-1.853-1.313 0-.728.83-1.315 1.853-1.315 1.024 0 1.854.588 1.854 1.315 0 .726-.83 1.313-1.854 1.313zm5.833 3.98c-1.137 0-2.06-.653-2.06-1.46s.923-1.462 2.06-1.462 2.06.656 2.06 1.463-.923 1.46-2.06 1.46zm5.917 5.17c-1.333 0-2.415-.767-2.415-1.713s1.082-1.714 2.415-1.714 2.416.768 2.416 1.714-1.083 1.712-2.416 1.712zm5.75 6.206c-1.56 0-2.825-.897-2.825-2.004s1.265-2.005 2.825-2.005 2.825.9 2.825 2.006-1.265 2.003-2.825 2.003zm6.333 7.014c-1.733 0-3.14-.996-3.14-2.226s1.407-2.228 3.14-2.228 3.14.998 3.14 2.228-1.407 2.226-3.14 2.226zm7.334 7.123c-1.926 0-3.488-1.107-3.488-2.474s1.56-2.476 3.487-2.476c1.925 0 3.487 1.11 3.487 2.476s-1.562 2.474-3.487 2.474zm9.916 6.774c-2.14 0-3.875-1.23-3.875-2.748 0-1.52 1.735-2.75 3.875-2.75s3.875 1.23 3.875 2.75c0 1.518-1.735 2.75-3.875 2.75zm12.292 3.626c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.958.417c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.792.25c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75z"/>
    </symbol>

    <symbol id="putainde-Icon-home" viewBox="0 0 512 512">
      <title>home icon</title>
      <path d="M394.072 174.805l-47.916-48.023v-38.31h47.916v86.333zM462 275.815h-42.508v166.213H92.508V275.815H50L256 69.972l206 205.843zm-165.153-3.843c-15.81-3.316-29.02 4.086-38.792 19.387-9.77-15.302-22.98-22.704-38.79-19.388-36.745 10.876-36.335 69.543 38.583 113.047 75.06-43.26 75.742-102.172 39-113.048z"/>
    </symbol>

    <symbol id="putainde-Icon-pencil" viewBox="0 0 512 512">
      <title>pencil icon</title>
      <path d="M74.686 340.686L50 460.95l122.365-22.585L379.52 231.21l-97.68-97.68L74.686 340.687zm228.402-135.654l-181.89 181.89-21.214-21.213 181.89-181.89 21.214 21.212zM462 148.732l-52.662 52.66-97.682-97.68 52.662-52.662L462 148.73z"/>
    </symbol>

    <symbol id="putainde-Icon-text-file" viewBox="0 0 512 512">
      <title>text-file icon</title>
      <path d="M256 370.312h-84.495v-30H256v30zm83.495-55.416h-167.99v-30h167.99v30zm0-55.334h-167.99v-30h167.99v30zM297.818 90v85.75h85.864V422H128.317V90h169.5m25-40h-234.5v412h335.365V150.75L322.818 50z"/>
    </symbol>

    <symbol id="putainde-Icon-twitter" viewBox="0 0 512 512">
      <title>twitter icon</title>
      <path d="M462 128.223c-15.158 6.724-31.45 11.27-48.547 13.31 17.45-10.46 30.854-27.025 37.164-46.764-16.333 9.686-34.422 16.72-53.676 20.51-15.417-16.428-37.385-26.69-61.697-26.69-54.56 0-94.668 50.915-82.337 103.786-70.25-3.524-132.534-37.177-174.223-88.314-22.142 37.983-11.485 87.69 26.158 112.85-13.853-.438-26.89-4.24-38.284-10.574-.917 39.162 27.146 75.78 67.795 83.95-11.895 3.236-24.925 3.977-38.17 1.446 10.755 33.58 41.973 58.018 78.96 58.7C139.605 378.28 94.847 390.72 50 385.435c37.406 23.982 81.837 37.977 129.57 37.977 156.933 0 245.596-132.55 240.252-251.435 16.517-11.917 30.846-26.804 42.178-43.755z"/>
    </symbol>
</svg><div class="putainde-Header"><div class="Grid"><div class="Grid-cell u-size5of12"><a href="../../.." class="putainde-SiteTitle"><img alt="Putain de code !" src="../../../images/p!-logo.svg" class="putainde-Logo"><span>Putain de code !</span></a></div><div class="Grid-cell u-size7of12"><nav class="putainde-Nav"><a href="../.." data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-bookmark"><use xlink:href="#putainde-Icon-bookmark"></use></svg> Articles</a><a href="../../../c-est-quoi-putaindecode" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-text-file"><use xlink:href="#putainde-Icon-text-file"></use></svg> Readme</a><a href="../../comment-contribuer" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-pencil"><use xlink:href="#putainde-Icon-pencil"></use></svg> Participer</a><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></nav></div></div></div><div class="putainde-Main"><article class="Grid putainde-Post"><div class="Grid-cell u-size8of12 Grid putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">La puissance de dnsmasq</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas">Écrit par <a href="http://kud.io">kud</a>, <span class="putainde-Date"> le 20 fév. 2014</span>. <span data-cssr-tooltip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingTime-wpm="250" class="putainde-Post-readingTime putainde-Post-readingTime--hidden cssr-Tooltip cssr-Tooltip--top">Temps de lecture : environ  <span class="putainde-Post-readingTime-value"></span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">dnsmasq</li><li class="putainde-Tag">macosx</li><li class="putainde-Tag">test</li><li class="putainde-Tag">dns</li><li class="putainde-Tag">serveur</li></ul></header><div class="putainde-Post-md"><p>Dernièrement, j’ai voulu accéder avec mon Smartphone à ma machine virtuelle (<em>VM</em>) de développement qui se trouve sur mon poste de travail (<em>machine ou poste hôte</em>). Ma machine virtuelle me permet de reproduire à l’identique la production afin d’avoir le moins de marge d’erreur possible entre la phase de développement et la phase de mise en production.</p>
<p>A ce moment là, j’accédais à ma machine virtuelle à partir de mon poste via le fichier <em>hosts</em> comprenant ceci :</p>
<pre><code><span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.145</span> monsite.<span class="hljs-built_in">dev</span>
</code></pre><p>Le problème est que seul mon poste est au courant de la résolution du nom de domaine de par cette méthode.</p>
<p>Étant donné qu’il est laborieux de changer des <em>hosts</em> sur un appareil comme un téléphone et que je n’ai pas non plus envie de dupliquer cette modification sur chaque appareil, il me fallait trouver une solution généralisée.</p>
<p>C’est là que <strong><a href="http://fr.wikipedia.org/wiki/Dnsmasq">dnsmasq</a></strong> entre en jeu.</p>
<blockquote>
<p>Dnsmasq est un serveur léger pour fournir les services DNS, DHCP, Bootstrap Protocol et TFTP pour un petit réseau, voire pour un poste de travail. Il permet d’offrir un service de nommage des machines du réseau interne non intégrées au service de nommage global (i.e. le service DNS d’Internet). Le service de nommage est associé au service d’adressage de telle manière que les machines dont le bail DHCP est fourni par Dnsmasq peuvent avoir automatiquement un nom DNS sur le réseau interne. Le logiciel offre un service DHCP statique ou dynamique.</p>
</blockquote>
<h2 id="dnsmasq-le-serveur-dns-tout-petit"><a class="putainde-Title-anchor" href="#dnsmasq-le-serveur-dns-tout-petit">#</a>dnsmasq, le serveur dns tout petit</h2><p><strong>dnsmasq</strong> va me permettre de faire plusieurs choses :</p>
<ul>
<li>accélérer la résolution dns</li>
<li>ne pas polluer le réseau interne de la boite avec des résolutions de domaines propre à votre poste (imaginez que vous soyez plusieurs à avoir <em>monsite.dev</em> (ce qui est le cas dans notre boite)); une résolution se ferait uniquement vers un seul poste donc impossible de faire sans si vous êtes plusieurs</li>
<li>ne pas dupliquer sur chacun appareil la résolution dns</li>
<li>réussir à résoudre un nom de domaine sur un appareil où le fichier <em>hosts</em> est difficile voire impossible d’accès</li>
</ul>
<p>Cependant, tout n’est pas si rose, je vais vous montrer pourquoi après.</p>
<h3 id="partage-de-connexion"><a class="putainde-Title-anchor" href="#partage-de-connexion">#</a>Partage de connexion</h3><p>Je vous propose dans un premier temps de partager votre connexion via le Wifi sous Mac OS X afin :</p>
<ul>
<li>d’avoir constamment un débit stable et performant; étant donné que vous êtes souvent devant votre poste pour tester sur différents appareils, en partageant votre connexion via Wifi, vous vous assurez d’avoir un excellent débit, chose qui n’est pas toujours évidente quand le wifi de votre boite est un peu / souvent trop loin</li>
<li>d’utiliser le serveur dns (dnsmasq) que vous allez monter</li>
</ul>
<p>Pour cela, il suffit de faire : <code>System Preferences &gt; Sharing &gt; Internet Sharing</code> puis choisir <code>Ethernet</code> en source, et <code>Wifi</code> en sortie. (Je vous conseille d’ailleurs de protéger votre Wifi avec une clé WPA2).</p>
<figure><img src="macosx-network-sharing.png" alt=""></figure>

<p><em>Ici, c’est USB Ethernet en source car je suis sur un Mac Book Air donc aucun port ethernet natif mais choisissez Ethernet si possible.</em></p>
<p>Une fois que le partage de connexion via Wifi est activé, vous pouvez vous y connecter avec votre smartphone (ou tablette).</p>
<p>Cela crée alors un nouveau réseau privé entre votre machine hôte et votre téléphone avec des adresses comme <code>192.168.2.x</code>. La machine hôte aura sûrement l’adresse <code>192.168.2.1</code> et votre téléphone très probablement <code>192.168.2.2</code>.</p>
<p>C’est alors un autre réseau que le réseau interne à la boite en <code>192.168.1.x</code>.</p>
<p>Notez aussi que la machine hôte, faisant bridge, donne les informations en cascade aux appareils connectés. Ce que vous spécifiez comme serveurs dns sur la machine hôte sera alors ceux utilisés par les appareils étant connectés à votre partage de réseau.</p>
<h3 id="aaaah-dnsmasq-"><a class="putainde-Title-anchor" href="#aaaah-dnsmasq-">#</a>Aaaah dnsmasq !</h3><p>On est sous Mac OS X, la vie est si simple, on installe <strong>dnsmasq</strong> via <strong>homebrew</strong>.</p>
<h4 id="dnsmasq-via-homebrew"><a class="putainde-Title-anchor" href="#dnsmasq-via-homebrew">#</a>dnsmasq via homebrew</h4><pre><code>$ brew <span class="hljs-keyword">install</span> dnsmasq
</code></pre><h4 id="configuration-de-dnsmasq"><a class="putainde-Title-anchor" href="#configuration-de-dnsmasq">#</a>configuration de dnsmasq</h4><p>Une fois installé, on copie la configuration :</p>
<pre><code>$ cp <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/opt/</span>dnsmasq<span class="hljs-regexp">/dnsmasq.conf.example /u</span>sr<span class="hljs-regexp">/local/</span>etc<span class="hljs-regexp">/dnsmasq.conf</span>
</code></pre><p>puis on édite le comme ceci :</p>
<pre><code># <span class="hljs-keyword">Add</span> domains which you want <span class="hljs-keyword">to</span> force <span class="hljs-keyword">to</span> an IP address here.
# The example below send any host <span class="hljs-keyword">in</span> double-click.net <span class="hljs-keyword">to</span> a local
# web-server.
#address=/double-click.net/<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>
address=/monsite.dev/<span class="hljs-number">192.168</span>.<span class="hljs-number">1.145</span>

# <span class="hljs-keyword">If</span> you want dnsmasq <span class="hljs-keyword">to</span> listen <span class="hljs-keyword">for</span> DHCP <span class="hljs-keyword">and</span> DNS requests only <span class="hljs-keyword">on</span>
# specified interfaces (<span class="hljs-keyword">and</span> the loopback) give the name <span class="hljs-keyword">of</span> the
# <span class="hljs-keyword">interface</span> (eg eth0) here.
# <span class="hljs-keyword">Repeat</span> the line <span class="hljs-keyword">for</span> more than one <span class="hljs-keyword">interface</span>.
#<span class="hljs-keyword">interface</span>=
# <span class="hljs-keyword">Or</span> you can specify which <span class="hljs-keyword">interface</span> _not_ <span class="hljs-keyword">to</span> listen <span class="hljs-keyword">on</span>
#<span class="hljs-keyword">except</span>-<span class="hljs-keyword">interface</span>=
# <span class="hljs-keyword">Or</span> which <span class="hljs-keyword">to</span> listen <span class="hljs-keyword">on</span> <span class="hljs-keyword">by</span> address (remember <span class="hljs-keyword">to</span> include <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-keyword">if</span>
# you use this.)
listen-address=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
# <span class="hljs-keyword">If</span> you don<span class="hljs-string">'t want dnsmasq to read /etc/hosts, uncomment the
# following line.
no-hosts</span>
</code></pre><p>Nous précisons dans un premier temps la résolution du nom de domaine <code>monsite.dev</code> (notez que c’est du wildcard, donc pas besoin de préciser les sous-domaines), puis nous indiquons que le serveur DNS marche sur toutes les IPs de la machine hôte et enfin nous indiquons que nous ne voulons pas prendre en compte le fichier <code>/etc/hosts</code> vu qu’on spécifie les résolutions via <code>address</code>.</p>
<p>Cela permettra à terme de ne plus gérer le fichier <code>/etc/hosts</code> et de tout spécifier dans <code>dnsmasq.conf</code>.</p>
<h4 id="lancer-dnsmasq-au-demarrage-de-la-machine"><a class="putainde-Title-anchor" href="#lancer-dnsmasq-au-demarrage-de-la-machine">#</a>lancer dnsmasq au démarrage de la machine</h4><p>On copie le fichier de démon dans le dossier qui va bien puis on lance le démon.</p>
<pre><code><span class="hljs-variable">$ </span>sudo cp -fv /usr/local/opt/dnsmasq/*.plist /<span class="hljs-constant">Library/LaunchDaemons</span>
<span class="hljs-variable">$ </span>sudo launchctl load /<span class="hljs-constant">Library/LaunchDaemons/</span>homebrew.mxcl.dnsmasq.plist
</code></pre><h4 id="utiliser-le-serveur-dnsmasq"><a class="putainde-Title-anchor" href="#utiliser-le-serveur-dnsmasq">#</a>utiliser le serveur dnsmasq</h4><p>Etant donné que vous partagez votre connexion et que votre poste fait hôte, le serveur dns utilisé sera celui installé sur votre poste, donc rien à faire.</p>
<p>Sinon :</p>
<ul>
<li><p>vous pouvez changer le serveur dns de la machine hôte dans <code>network</code> et dans ce cas, que ce soit sur vos appareils connectés au wifi ou votre machine principale, vous utiliserez <strong>dnsmasq</strong> mais je vous le déconseile car j’ai constaté que j’atteignais trop facilement le nombre de connexions maximum.</p>
</li>
<li><p>vous pouvez aussi modifier le serveur dns de l’appareil connecté au wifi partagé :</p>
</li>
</ul>
<p><em>(Sous Android)</em></p>
<p><code>Wifi &gt; Press on the current connnection &gt; Modify network &gt; Show advanced options</code></p>
<figure><img src="android-network-advanced.jpg" alt=""></figure>

<p>Mais quel intérêt car vous devrez faire cela sur tous vos appareils connectés</p>
<ul>
<li>vous pouvez aussi éditer le fichier <code>/etc/bootpd.plist</code> qui définit toute votre configuration de partage de connexion :</li>
</ul>
<pre><code><span class="hljs-variable">$ </span>sudo <span class="hljs-variable">$EDITOR</span> /etc/bootpd.plist
</code></pre><pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">plist</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>Subnets<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dict</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>_creator<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>com.apple.InternetSharing<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>allocate<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_domain_name_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_router<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_max<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>lease_min<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">integer</span>&gt;</span>86400<span class="hljs-tag">&lt;/<span class="hljs-title">integer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>name<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2/24<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_address<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_mask<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>255.255.255.0<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>net_range<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.2<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>192.168.2.254<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>bootp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>detect_other_dhcp_server<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">true</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>dhcp_enabled<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>bridge100<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">array</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>use_server_config_for_dhcp_options<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">false</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">plist</span>&gt;</span>
</code></pre>
<p><code>192.168.2.1</code> est l’adresse de votre machine hôte dans le réseau de partage.</p>
<h2 id="oh-oui-j-oubliais-mac-os-x-peut-etre-lourd-parfois"><a class="putainde-Title-anchor" href="#oh-oui-j-oubliais-mac-os-x-peut-etre-lourd-parfois">#</a>Oh oui, j’oubliais, Mac OS X peut être lourd parfois</h2><p>Oui, quand vous créez un partage de connexion sur Mac OS X, il lance son propre serveur dns s’appelant <strong>_mdnsresponder</strong>. C’est le système <em>Bonjour</em> de iOS/Mac OS X permettant à n’importe quel appareil Apple de communiquer entre eux. Le problème c’est qu’il risque de marcher sur les pieds de <strong>dnsmasq</strong>.</p>
<p>Faites donc un <code>$ sudo lsof -i :53</code> et vous pourrez éventuellement voir que <strong>_mdnsresponder</strong> est lancé aussi bien en ipv6 qu’en ipv4 sur le port 53. Cela vous empêchera de lancer <strong>dnsmasq</strong>.</p>
<p>Ce que je vous propose dans ces cas là, c’est de couper votre partage de connexion, puis notez le pid de <strong>_mdnsresponder</strong> via <code>$ sudo lsof -i :53</code>, de le <code>sudo kill :pid</code>, de lancer <code>$ sudo dnsmasq</code> puis de relancer le partage de connexion. Comme ça <strong>_mdnsresponser</strong> ne prendra plus la place de <strong>dnsmasq</strong>.</p>
<p>Autre point, évitez, mais vraiment, de nommer vos noms de domaines personnels en <code>.local</code>. En effet, ceux-ci sont plutôt réservés à l’environnement Mac OS X. Ils sont d’ailleurs en rapport avec <strong>_mdnsresponder</strong>. Les <code>.local</code> permettent à n’importe quel produit Apple sur le réseau de se connecter à d’autres postes Apple via <code>nom-de-l-appareil.local</code>. Votre connexion pourrait alors s’emméler entre le serveur dns de <strong>Bonjour</strong> et votre propre serveur dns.</p>
<p>Happy coding !</p>
</div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="Grid"><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/edit/master/src/pages/posts/env/la-puissance-de-dnsmasq/index.md" class="putainde-Post-footer-action">Modifier</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/blame/master/src/pages/posts/env/la-puissance-de-dnsmasq/index.md" class="putainde-Post-footer-action">Tracer les changements</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/commits/master/src/pages/posts/env/la-puissance-de-dnsmasq/index.md" class="putainde-Post-footer-action">Historique</a></div></div></footer><div class="putainde-Author"><a href="http://kud.io" class="putainde-Avatar putainde-Author-picture"><img src="https://avatars.githubusercontent.com/u/655838?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par</span> <a href="http://kud.io" class="putainde-Link">kud</a></h3><div class="putainde-Author-social"><a href="http://kud.io" data-cssr-tooltip="Website" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-home"><use xlink:href="#putainde-Icon-home"></use></svg></a><a href="https://twitter.com/_kud" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a><a href="https://github.com/kud" data-cssr-tooltip="Github" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></div></div><p class="putainde-Author-bio">Viking UI engineer (avec une pointe de node.js), batteur, s'essayant à la photographie, aime le cinema.</p></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">3 contributeurs</strong><div data-cssr-tooltip="MoOx" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div><div data-cssr-tooltip="kud" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://kud.io" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/655838?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div><div data-cssr-tooltip="bloodyowl" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://bloodyowl.github.io" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/1688645?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div></div><div id="disqus_thread" aria-live="polite"><noscript>| Please enable JavaScript to view the
a(href="http://disqus.com/?ref_noscript") comments powered by Disqus.</noscript></div></div></article></div><div class="putainde-Footer"><div class="Grid"><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text">© 1970 - 2015 Putain de code !</p></div><div class="Grid-cell u-size6of12"><ul class="putainde-Footer-list"><li><a href="../../../feed.xml">Flux RSS</a></li><li><a href="../../../projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><li><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></li><li><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></li></ul></div><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎</p></div></div></div><script>var disqus_shortname = "putaindecode";var disqus_identifier = "http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/";
var disqus_url = "http://putaindecode.fr/posts/env/la-puissance-de-dnsmasq/";
var disqus_script = "embed.js";;(function(d,s) {
s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
(d.getElementsByTagName('head')[0]).appendChild(s)
})(document)</script><script src="../../../scripts/index.js"></script><script>var _gaq=[['_setAccount','UA-43771806-1'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src='//www.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>