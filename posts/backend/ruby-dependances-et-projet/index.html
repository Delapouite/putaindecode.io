<!doctype html>
<html lang="fr" class="r-VerticalRhythm"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui"><title>Dépendances et premier projet en Ruby</title><link rel="stylesheet" href="/index.css"><link rel="alternate" href="/feed.xml" title="Dépendances et premier projet en Ruby" type="application/atom+xml"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@putaindecode"><meta name="twitter:title" content="Dépendances et premier projet en Ruby"><meta name="twitter:creator" content="@rhannequin"><meta property="og:title" content="Dépendances et premier projet en Ruby"><meta property="og:type" content="article"><meta property="og:site_name" content="Putain de code !"></head><body><div class="putainde-Header"><div class="r-Grid"><div class="r-Grid-cell r-all--5of12"><a class="putainde-SiteTitle" href="/"><img class="putainde-Logo" alt="Putain de code !" src="/images/p!-logo.svg"><span>Putain de code !</span></a></div><div class="r-Grid-cell r-all--7of12"><nav class="putainde-Nav"><a class="putainde-Nav-item" href="/posts" data-r-tooltip=""><img class="putainde-Icon" src="/icons/bookmark.svg">Articles</a><a class="putainde-Nav-item" href="/c-est-quoi-putaindecode" data-r-tooltip=""><img class="putainde-Icon" src="/icons/text-file.svg">Readme</a><a class="putainde-Nav-item" href="/posts/comment-contribuer" data-r-tooltip=""><img class="putainde-Icon" src="/icons/pencil.svg">Participer</a><a class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip--bottom" href="https://github.com/putaindecode/" data-r-tooltip="GitHub"><img class="putainde-Icon" src="/icons/github.svg"></a><a class="putainde-Nav-item putainde-Nav-item--icon r-Tooltip r-Tooltip--bottom" href="https://twitter.com/putaindecode/" data-r-tooltip="Twitter"><img class="putainde-Icon" src="/icons/twitter.svg"></a></nav></div></div></div><div class="putainde-Main"><article class="r-Grid putainde-Post"><div class="r-Grid-cell r-all--8of12 putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">Dépendances et premier projet en Ruby</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas"><span>Écrit par <span><a href="http://rhannequ.in">rhannequin</a><span></span></span></span><span>, </span><span class="putainde-Date"> le 14 oct. 2014</span>. <span class="putainde-Post-readingTime putainde-Post-readingTime--hidden r-Tooltip r-Tooltip--top" data-r-tooltip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingtime-wpm="250">Temps de lecture : environ  <span class="putainde-Post-readingTime-value">...</span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">backend</li><li class="putainde-Tag">ruby</li></ul></header><div class="putainde-Post-md"><div><p><a href="#tl-dr">tl;dr</a></p>
<p>Dans l’<a href="/posts/backend/premiers-pas-avec-ruby">article précédent</a>
nous avons installé Ruby. Désormais nous allons aborder les gems,
les dépendances et commencer notre web service.</p>
<p>Un gem en Ruby c’est une lib, comme un paquet NPM pour NodeJS. C’est
d’ailleurs le système de rubygems qui a inspiré le système de NPM.
Pour installer un gem, rien de plus simple que <code>gem install sass</code>,
qui ici va installer la bibliothèque <code>sass</code>.</p>
<p>Un projet Ruby nécessite la plupart du temps des bibliothèques afin
de ne pas tout faire soi-même, il est donc nécessaire d’avoir une
gestion des dépendances pour le projet.</p>
<h2 id="bundler-le-gem-qui-g-re-les-gems">Bundler, le gem qui gère les gems</h2>
<p><a href="http://bundler.io">Bundler</a> est un gem qui va vous permettre de créer un fichier Gemfile
contenant vos dépendances, et qui vous installera les gems
nécessaires avec la gestion des versions et de leurs propres
dépendances. Un fichier Gemfile se présente comme ceci :</p>
<pre><code class="hljs ruby">source <span class="hljs-string">'https://rubygems.org'</span>
ruby <span class="hljs-string">'2.1.2'</span>
gem <span class="hljs-string">'sinatra'</span></code></pre>

<p>L’instruction <code>source</code> permet de préciser l’url des dépôts de gems.
La version de ruby n’est pas obligatoire mais j’aime la préciser pour
ne pas me mélanger dans mes projets avec différentes versions de Ruby
(voir le
<a href="/posts/backend/premiers-pas-avec-ruby">précédent article pour les versions du Ruby</a>
et <a href="https://github.com/sstephenson/rbenv">rbenv</a>). Et enfin, la
déclaration de notre première bibliothèque de dépendance :
<a href="http://www.sinatrarb.com">Sinatra</a>.</p>
<p>Il est possible d’être bien plus précis dans le Gemfile, comme…</p>
<p>Préciser dans quel environnement charger les gems :</p>
<pre><code class="hljs ruby">gem <span class="hljs-string">'sqlite3'</span>, <span class="hljs-symbol">group:</span> [<span class="hljs-symbol">:development</span>, <span class="hljs-symbol">:test</span>]</code></pre>

<p>Une numéro de version :</p>
<pre><code class="hljs ruby">gem <span class="hljs-string">'rails'</span>, <span class="hljs-string">'4.1.6'</span>         <span class="hljs-comment"># version 4.1.6</span>
<span class="hljs-prompt">gem 'sass-rails', '~&gt;</span> <span class="hljs-number">4.0</span>.<span class="hljs-number">3</span><span class="hljs-string">' # &gt;= 4.0.3 mais &lt; 4.1.0</span></code></pre>

<p>Préciser la classe à charger :</p>
<pre><code class="hljs ruby">gem <span class="hljs-string">'valid_email'</span>, <span class="hljs-symbol">require:</span> <span class="hljs-string">'valid_email/email_validator'</span></code></pre>

<p>Aller chercher directement sur Github :</p>
<pre><code class="hljs ruby">gem <span class="hljs-string">'nokogiri'</span>, <span class="hljs-symbol">github:</span> <span class="hljs-string">'sparklemotion/nokogiri'</span>
<span class="hljs-comment"># https://github.com/sparklemotion/nokogiri.git</span>

gem <span class="hljs-string">'rails'</span>, <span class="hljs-symbol">github:</span> <span class="hljs-string">'rails'</span>
<span class="hljs-comment"># https://github.com/rails/rails.git</span>

gem <span class="hljs-string">'rails'</span>, <span class="hljs-symbol">github:</span> <span class="hljs-string">'rails'</span>, <span class="hljs-symbol">branch:</span> <span class="hljs-string">'4-1-stable'</span>
<span class="hljs-comment"># https://github.com/rails/rails.git sur la branche 4-1-stable</span></code></pre>

<p>Il existe encore d’autres instructions, de quoi rendre sa gestion des
dépendances vraiment fine et précise.</p>
<p>Une fois le Gemfile prêt, bundler a plusieurs commandes de
disponibles pour pouvoir les télécharger et utiliser.</p>
<ul>
<li><code>$ bundle install</code> installera les gems requis</li>
<li><code>$ bundle update</code> mettra à jour vers les versions les plus récentes si possible les gems requis</li>
<li><code>$ bundle exec</code> permettra de précéder une commande ruby afin de l’exécuter dans le contexte du Gemfile, très utile lorsque l’on a différentes versions de Ruby qui se baladent dans le terminal</li>
</ul>
<p>Bundler va générer un fichier <code>Gemfile.lock</code> qui est la description
exhaustive des dépendances de votre application, chaque gem avec le
numéro de sa version installée, chaque dépendance pour chaque gem,
une jolie arborescence plus que précise.</p>
<h2 id="commen-ons-notre-web-service">Commençons notre web service</h2>
<p>Assez parlé des outils qui existent, utilisons-les. Tout d’abord
installons Bundler, sans oublier le <code>$ rbenv rehash</code> nécessaire si vous
utilisez rbenv pour vos versions de Ruby afin de mettre à jour les
commandes disponibles dans le terminal :</p>
<pre><code class="hljs"><span class="hljs-variable">$ </span>gem install bundler
<span class="hljs-variable">$ </span>rbenv rehash</code></pre>

<p>Pour notre première application, nous allons faire un web service
avec Sinatra qui est un micro-framework web, ayant d’ailleurs
clairement inspiré Express (“Sinatra inspired web development
framework for node.js”). Notre Gemfile va donc être exactement
comme notre premier exemple :</p>
<pre><code class="hljs ruby">source <span class="hljs-string">'https://rubygems.org'</span>
ruby <span class="hljs-string">'2.1.2'</span>
gem <span class="hljs-string">'sinatra'</span></code></pre>

<p>Un petit <code>bundle install</code> et nous sommes prêts à démarrer !</p>
<p>Pour ne pas brusquer les choses, nous allons faire la version la plus
simple d’un web service avec Sinatra, ce qui nous permettra de
constater la simplicité extrême de Ruby et du framework :</p>
<pre><code class="hljs ruby"><span class="hljs-comment">########</span>
<span class="hljs-comment"># app.rb</span>
<span class="hljs-comment">#</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">'sinatra'</span>

get <span class="hljs-string">'/'</span> <span class="hljs-keyword">do</span>
  <span class="hljs-string">'Hello World!'</span>
<span class="hljs-keyword">end</span></code></pre>

<p>Qu’avons-nous fait là ? Pas grand chose, et en même temps tout juste
ce qu’il faut. Nous avons inclus le gem à notre script et utilisé la
méthode Sinatra <code>get</code> nous permettant de déclarer un point d’entrée
en <code>GET</code> sur la route ‘/‘. Cette méthode prend également comme
argument un <code>block</code> caractérisé par le <code>do</code> et le <code>end</code>. La dernière
valeur du block étant la valeur de retour, nous renvoyons la seule
chaîne de caractères “Hello World!”.</p>
<p>Et maintenant : lancement ! <code>$ bundle exec ruby app.rb</code> va lancer
l’application (mais <code>ruby app.rb</code> suffit), par défaut sur le port
<code>4567</code>. Regardez vite <a href="http://localhost:4567">http://localhost:4567</a>
et là magie, “Hello World!” sur une magnifique page blanche, notre
tout premier web service est fonctionnel.</p>
<p>Alors oui, ce n’est pas une révolution. Mais tout de même, en
réduisant la syntaxe du block on se retrouve avec un script de deux
lignes qui crée un vrai web service web. Et vous allez vite voir
qu’en quelques lignes de plus on peut vite complexifier le bousin.</p>
<h2 id="au-prochain-pisode">Au prochain épisode</h2>
<p>Dans l’article suivant nous allons ajouter des fonctionnalités à
notre toute nouvelle application, de nouvelles routes, de la
persistence et aussi des vues dans un format un peu plus utile.</p>
<p>Stay tuned!</p>
<h2 id="tl-dr">tl;dr</h2>
<p>Voici la version abrégée de cet article :</p>
<pre><code class="hljs ruby"><span class="hljs-comment"># Gemfile</span>
source <span class="hljs-string">'https://rubygems.org'</span>
ruby <span class="hljs-string">'2.1.2'</span>
gem <span class="hljs-string">'sinatra'</span></code></pre>

<pre><code class="hljs ruby"><span class="hljs-comment"># app.rb</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'sinatra'</span>
get <span class="hljs-string">'/'</span> <span class="hljs-keyword">do</span>
  <span class="hljs-string">'Hello World!'</span>
<span class="hljs-keyword">end</span></code></pre>

<pre><code><span class="hljs-variable">$ </span>gem install bundler
<span class="hljs-variable">$ </span>rbenv rehash
<span class="hljs-variable">$ </span>bundle install
<span class="hljs-variable">$ </span>ruby app.rb</code></pre>

<h2 id="sources">Sources</h2>
<ul>
<li><a href="https://rubygems.org">RubyGems</a></li>
<li><a href="http://bundler.io">Bundler</a></li>
<li><a href="https://github.com/sstephenson/rbenv">rbenv</a></li>
<li><a href="http://www.sinatrarb.com">Sinatra</a> et surtout son <a href="http://www.sinatrarb.com/intro.html">README</a></li>
</ul>
</div></div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="r-Grid"><div class="r-Grid-cell r-all--1of3"><a class="putainde-Post-footer-action" href="http://github.com/putaindecode/putaindecode.fr/edit/master/content/posts/backend/ruby-dependances-et-projet/index.md">Modifier</a></div><div class="r-Grid-cell r-all--1of3"><a class="putainde-Post-footer-action" href="http://github.com/putaindecode/putaindecode.fr/blame/master/content/posts/backend/ruby-dependances-et-projet/index.md">Tracer les changements</a></div><div class="r-Grid-cell r-all--1of3"><a class="putainde-Post-footer-action" href="http://github.com/putaindecode/putaindecode.fr/commits/master/content/posts/backend/ruby-dependances-et-projet/index.md">Historique</a></div></div><div><div class="putainde-Author undefined"><a href="http://rhannequ.in" class="putainde-Avatar putainde-Author-picture"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1019025?v=3&amp;s=128" alt=""></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par </span><a class="putainde-Link" href="http://rhannequ.in">rhannequin</a></h3><div class="putainde-Author-social"><a href="http://rhannequ.in" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Website"><img class="putainde-Icon" src="/icons/home.svg"></a><a href="https://twitter.com/rhannequin" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Twitter"><img class="putainde-Icon" src="/icons/twitter.svg"></a><a href="https://github.com/rhannequin" class="r-Tooltip r-Tooltip--top" data-r-tooltip="Github"><img class="putainde-Icon" src="/icons/github.svg"></a></div></div><p class="putainde-Author-bio">Développeur frontend/backend spécialement intéressé par JavaScript et Ruby.Curieux des hacks sur les technologies web, conscient des standards de performance, de tests, et du web tout court.Joueur de handball depuis l&#x27;enfance, amoureux de l&#x27;espace et de la science, matteur de séries.Baigné dans de la musique et un mode de vie funkys.</p></div></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">3 contributeurs</strong><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="MoOx
(3 commits)"><a href="http://moox.io/" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/157534?v=3&amp;s=128" alt=""></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="rhannequin
(1 commit)"><a href="http://rhannequ.in" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/1019025?v=3&amp;s=128" alt=""></a></div><div class="putainde-Contributor r-Tooltip r-Tooltip--bottom r-Tooltip--allowNewLines" data-r-tooltip="Nyalab
(1 commit)"><a href="http://putaindecode.fr" class="putainde-Avatar putainde-Contributor-avatar"><img class="js-AnimateLoad" src="https://avatars.githubusercontent.com/u/721993?v=3&amp;s=128" alt=""></a></div></div><div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></footer></div></article></div><div class="putainde-Footer"><div class="r-Grid"><div class="r-Grid-cell r-all--3of12"><p class="putainde-Footer-text">© 1970 - 2015 Putain de code !</p></div><div class="r-Grid-cell r-all--6of12"><ul class="putainde-Footer-list"><li><a href="/feed.xml">Flux RSS</a></li><li><a href="/projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><li><a href="https://github.com/putaindecode/" data-r-tooltip="GitHub" class="r-Tooltip r-Tooltip--top"><img class="putainde-Icon" src="/icons/github.svg"></a></li><li><a href="https://twitter.com/putaindecode/" data-r-tooltip="Twitter" class="r-Tooltip r-Tooltip--top"><img class="putainde-Icon" src="/icons/twitter.svg"></a></li></ul></div><div class="r-Grid-cell r-all--3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎</p></div></div></div><script>var _gaq=[["_setAccount","UA-43771806-1"],["_trackPageview"]];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src="//www.google-analytics.com/ga.js";s.parentNode.insertBefore(g,s)}(document,"script"));</script><script>var disqus_shortname = "putaindecode";
var disqus_identifier = "http://putaindecode.fr/posts/backend/ruby-dependances-et-projet/index.md";
var disqus_url = "http://putaindecode.fr/posts/backend/ruby-dependances-et-projet/index.md";
var disqus_script = "embed.js";

(function(d,s) {
  s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
  (d.getElementsByTagName('head')[0]).appendChild(s)
})(document)
    </script></body></html>
<script src="http://localhost:4243/livereload.js"></script>
