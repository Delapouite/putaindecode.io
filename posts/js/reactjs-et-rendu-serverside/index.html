<!DOCTYPE html><html lang="fr" class="cssr-VerticalRhythm"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui"><title>Quelques retours sur React et le rendu serveur</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@putaindecode"/><meta name="twitter:title" content="Quelques retours sur React et le rendu serveur"/><meta name="twitter:creator" content="@b_lionel"/><meta property="og:title" content="Quelques retours sur React et le rendu serveur"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Putain de code !"/><link rel="stylesheet" href="../../../stylesheets/index.css"><link rel="alternate" href="../../../feed.xml" title="Putain de code !" type="application/atom+xml"></head><body><svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="putainde-Icon-bookmark" viewBox="0 0 512 512">
      <title>bookmark icon</title>
      <path d="M318.275 90v283.23L256 318.16l-62.275 55.07V90h124.55m40-40h-204.55v412L256 371.557 358.275 462V50z"/>
    </symbol>

    <symbol id="putainde-Icon-github" viewBox="0 0 512 512">
      <title>github icon</title>
      <path d="M461.633 250.645l.367-3.82c-22.896-2.22-45.667-2.418-67.79-.73 3.557-11.346 5.43-24.163 5.295-38.738-.292-30.965-10.616-55.08-26.843-75.096 3.116-18.85.77-37.7-5.11-56.56-23.188 1.898-44.054 9.493-62.635 22.686-34.725-7.044-69.447-7.493-104.172 0-21.673-14.627-42.956-21.802-63.91-22.686-6.21 20.765-7.168 41.233-1.916 61.357-18.28 19.397-25.27 42.944-24.926 69.02.196 14.926 2.496 28.208 6.738 39.95-21.796-1.598-44.2-1.385-66.732.8l.367 3.818c22.947-2.228 45.76-2.41 67.92-.678.813 1.974 1.632 3.94 2.566 5.815-24.01-.633-45.618 1.453-65.854 6.43l.913 3.723c20.538-5.048 42.54-7.08 67.107-6.254 16.246 28.865 47.52 45.825 93.063 51.206-10.58 8.594-16.27 18.73-17.735 30.2h-24.12c-32.395 0-41.227-41.303-74.78-37.228C132 320 125.5 371.598 177.588 371.598h21.88v47.297c.234 7.643-3.093 12.754-8.47 16.297 18.655 1.884 32.675-7.43 32.675-18.854V353.82l5.833-6v72.992c.245 7.265-3.284 11.392-7.03 15.34 16.433.653 31.89-2.63 32.59-16.616V349.68s5.757-3.6 5.757 0v66.58c.17 11.8 10.36 21.366 31.953 19.892-5.776-4.65-7.55-9.35-7.55-16.15v-72.18s5.95-.307 5.95 6v60.88c0 13.55 16.268 19.14 34.83 18.615-6.08-4.558-10.196-9.99-10.223-17.256v-73.216c-.63-10.762-5.003-20.906-13.582-30.358 41.63-6.392 71.638-23.01 86.58-52.796 24.646-.847 46.714 1.183 67.306 6.246l.914-3.723c-20.394-5.014-42.18-7.096-66.416-6.415.84-1.89 1.67-3.79 2.39-5.785 22.39-1.798 45.457-1.622 68.66.632zM114 310.023c-1.023 0-1.853-.588-1.853-1.313 0-.728.83-1.315 1.853-1.315 1.024 0 1.854.588 1.854 1.315 0 .726-.83 1.313-1.854 1.313zm5.833 3.98c-1.137 0-2.06-.653-2.06-1.46s.923-1.462 2.06-1.462 2.06.656 2.06 1.463-.923 1.46-2.06 1.46zm5.917 5.17c-1.333 0-2.415-.767-2.415-1.713s1.082-1.714 2.415-1.714 2.416.768 2.416 1.714-1.083 1.712-2.416 1.712zm5.75 6.206c-1.56 0-2.825-.897-2.825-2.004s1.265-2.005 2.825-2.005 2.825.9 2.825 2.006-1.265 2.003-2.825 2.003zm6.333 7.014c-1.733 0-3.14-.996-3.14-2.226s1.407-2.228 3.14-2.228 3.14.998 3.14 2.228-1.407 2.226-3.14 2.226zm7.334 7.123c-1.926 0-3.488-1.107-3.488-2.474s1.56-2.476 3.487-2.476c1.925 0 3.487 1.11 3.487 2.476s-1.562 2.474-3.487 2.474zm9.916 6.774c-2.14 0-3.875-1.23-3.875-2.748 0-1.52 1.735-2.75 3.875-2.75s3.875 1.23 3.875 2.75c0 1.518-1.735 2.75-3.875 2.75zm12.292 3.626c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.958.417c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.792.25c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75z"/>
    </symbol>

    <symbol id="putainde-Icon-home" viewBox="0 0 512 512">
      <title>home icon</title>
      <path d="M394.072 174.805l-47.916-48.023v-38.31h47.916v86.333zM462 275.815h-42.508v166.213H92.508V275.815H50L256 69.972l206 205.843zm-165.153-3.843c-15.81-3.316-29.02 4.086-38.792 19.387-9.77-15.302-22.98-22.704-38.79-19.388-36.745 10.876-36.335 69.543 38.583 113.047 75.06-43.26 75.742-102.172 39-113.048z"/>
    </symbol>

    <symbol id="putainde-Icon-pencil" viewBox="0 0 512 512">
      <title>pencil icon</title>
      <path d="M74.686 340.686L50 460.95l122.365-22.585L379.52 231.21l-97.68-97.68L74.686 340.687zm228.402-135.654l-181.89 181.89-21.214-21.213 181.89-181.89 21.214 21.212zM462 148.732l-52.662 52.66-97.682-97.68 52.662-52.662L462 148.73z"/>
    </symbol>

    <symbol id="putainde-Icon-text-file" viewBox="0 0 512 512">
      <title>text-file icon</title>
      <path d="M256 370.312h-84.495v-30H256v30zm83.495-55.416h-167.99v-30h167.99v30zm0-55.334h-167.99v-30h167.99v30zM297.818 90v85.75h85.864V422H128.317V90h169.5m25-40h-234.5v412h335.365V150.75L322.818 50z"/>
    </symbol>

    <symbol id="putainde-Icon-twitter" viewBox="0 0 512 512">
      <title>twitter icon</title>
      <path d="M462 128.223c-15.158 6.724-31.45 11.27-48.547 13.31 17.45-10.46 30.854-27.025 37.164-46.764-16.333 9.686-34.422 16.72-53.676 20.51-15.417-16.428-37.385-26.69-61.697-26.69-54.56 0-94.668 50.915-82.337 103.786-70.25-3.524-132.534-37.177-174.223-88.314-22.142 37.983-11.485 87.69 26.158 112.85-13.853-.438-26.89-4.24-38.284-10.574-.917 39.162 27.146 75.78 67.795 83.95-11.895 3.236-24.925 3.977-38.17 1.446 10.755 33.58 41.973 58.018 78.96 58.7C139.605 378.28 94.847 390.72 50 385.435c37.406 23.982 81.837 37.977 129.57 37.977 156.933 0 245.596-132.55 240.252-251.435 16.517-11.917 30.846-26.804 42.178-43.755z"/>
    </symbol>
</svg><div class="putainde-Header"><div class="Grid"><div class="Grid-cell u-size5of12"><a href="../../.." class="putainde-SiteTitle"><img alt="Putain de code !" src="../../../images/p!-logo.svg" class="putainde-Logo"><span>Putain de code !</span></a></div><div class="Grid-cell u-size7of12"><nav class="putainde-Nav"><a href="../.." data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-bookmark"><use xlink:href="#putainde-Icon-bookmark"></use></svg> Articles</a><a href="../../../c-est-quoi-putaindecode" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-text-file"><use xlink:href="#putainde-Icon-text-file"></use></svg> Readme</a><a href="../../comment-contribuer" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-pencil"><use xlink:href="#putainde-Icon-pencil"></use></svg> Participer</a><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></nav></div></div></div><div class="putainde-Main"><article class="Grid putainde-Post"><div class="Grid-cell u-size8of12 Grid putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">Quelques retours sur React et le rendu serveur</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas">Écrit par <a href="http://lumographe.fr/">lionelB</a>, <span class="putainde-Date"> le 23 fév. 2015</span>. <span data-cssr-tooltip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingTime-wpm="250" class="putainde-Post-readingTime putainde-Post-readingTime--hidden cssr-Tooltip cssr-Tooltip--top">Temps de lecture : environ  <span class="putainde-Post-readingTime-value"></span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">javascript</li><li class="putainde-Tag">react</li></ul></header><div class="putainde-Post-md"><p>On entend souvent parler d’applications JavaScript isomorphiques, et même si le 
nom ne <a href="https://news.ycombinator.com/item?id=8237449">fait</a> <a href="https://twitter.com/wycats/status/566857009836724224">pas</a> 
<a href="https://medium.com/the-thinkmill/making-the-case-for-progressive-javascript-a98dfa82b9d7">l’unanimité</a>, 
ce qu’il y a derrière, le concept de <em>server side rendered JavaScript</em> est en 
passe de devenir  un sujet plutôt tendance pour 2015 grâce à la monté en puissance 
de <a href="http://facebook.github.io/react/">Reactjs</a>.  Faire du rendu d’application 
JavaScript coté serveur permet de réconcilier enfin le développeur de 
<em>Single Page App</em> (SPA) avec l’amélioration progressive, l’accessibilité et le 
SEO&nbsp;; quoique Google comme les lecteurs d’écran ont plutôt bien évolué sur
ce point. L’autre avantage non négligeable à mon sens, est qu’on améliore les 
performances perçues par rapport
 à une SPA classique puisque&nbsp;:</p>
<ul>
<li>On supprime une requête <em>ajax</em> au démarrage pour récupérer le contenu
initial. </li>
<li>On améliore la vitesse de rendu initial de page. </li>
<li>On bénéficie de la fluidité de navigation d’une SPA.</li>
</ul>
<p>Pour plus d’info sur les avantages, il y a <a href="http://tech.m6web.fr/isomorphic-single-page-app-parfaite-react-flux/">cet article</a> sur le blog de M6Tech.</p>
<p>Afin de me familiariser avec React et son écosystème, rien de mieux que mettre 
les mains dedans&nbsp;! C’est un peu pour toutes ces raisons que j’ai décidé de 
l’utiliser pour mon site web (un site statique). </p>
<p><strong>Inutile et donc totalement justifié pour le développeur que je suis</strong>. 
Une des premières briques que j’ai mises en place a été le routeur.</p>
<h2 id="react-router"><a class="putainde-Title-anchor" href="#react-router">#</a>react-router</h2><p>Pour une fois dans la communauté JavaScript, il y a une bibliothèque de référence 
et c’est celle là : <a href="https://github.com/rackt/react-router">react-router</a>. 
Le routeur est fortement inspiré par celui d’Ember au sens où les URL et leurs routes 
sont au cœur du dispositif. Le routeur se présente sous forme de composant React 
et ça donne ça.</p>
<pre><code class="lang-jsx">//routes.js

var <span class="hljs-variable">React =</span> require(<span class="hljs-string">"react"</span>);
var <span class="hljs-variable">Router =</span> require(<span class="hljs-string">"react-router"</span>);

var <span class="hljs-variable">Route =</span> Router.Route;
var <span class="hljs-variable">DefaultRoute =</span> Router.DefaultRoute;
var <span class="hljs-variable">NotFoundRoute =</span> Router.NotFoundRoute;

var <span class="hljs-variable">App =</span> require(<span class="hljs-string">"./app"</span>);
var <span class="hljs-variable">Home =</span> require(<span class="hljs-string">"./home/homePage"</span>);
var <span class="hljs-variable">Project =</span> require(<span class="hljs-string">"./project/projectPage"</span>);
var <span class="hljs-variable">NotFound =</span> require(<span class="hljs-string">"./notFound"</span>);

var <span class="hljs-variable">routes =</span> (
  &lt;Route <span class="hljs-variable">path=</span><span class="hljs-string">"/"</span> <span class="hljs-variable">handler=</span>{App}&gt;
    &lt;DefaultRoute <span class="hljs-variable">name=</span><span class="hljs-string">"index"</span> <span class="hljs-variable">handler=</span>{Home} /&gt;
    &lt;Route <span class="hljs-variable">name=</span><span class="hljs-string">"project"</span> <span class="hljs-variable">path=</span><span class="hljs-string">"/projects/:url"</span> <span class="hljs-variable">handler=</span>{Project} /&gt;
    &lt;NotFoundRoute <span class="hljs-variable">name=</span><span class="hljs-string">"404"</span> <span class="hljs-variable">handler=</span>{NotFound} /&gt;
  &lt;/Route&gt;
);

module.<span class="hljs-variable">exports =</span> routes;
</code></pre>
<p>À mon sens, l’aspect déclaratif apporte de la clarté et améliore la compréhension 
du système. On voit rapidement quel composant est utilisé en fonction de l’URL. 
L’autre avantage du déclaratif, c’est qu’il permet de manière assez simple, 
d’imbriquer les routes en imbriquant les nœuds <code>&lt;Route&gt;</code>.</p>
<p>En plus des composants, on a aussi à disposition des <em>mixins</em> pour naviguer 
programmatiquement ou accéder aux infos du routeur (chemin, paramètres, …)</p>
<p>Et le gros plus de cette bibliothèque : elle peut aussi s’utiliser coté serveur, 
pour la génération des vues et éviter ainsi de dupliquer du code puisqu’on va 
pouvoir carrément utiliser tel quel le fichier précédent. Plutôt cool&nbsp;!
Voici un exemple de <em>middleware</em> pour faire marcher ça dans Express&nbsp;:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">"react"</span>);
<span class="hljs-keyword">var</span> Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">"react-router"</span>);

<span class="hljs-comment">// notre fichier routes.js</span>
<span class="hljs-keyword">var</span> routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/routes"</span>);
<span class="hljs-comment">// notre template de page html</span>
<span class="hljs-keyword">var</span> Html = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./src/html"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reactView</span><span class="hljs-params">(req, res, next)</span> </span>{
  Router.run(routes, req.url, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(Handler, state)</span> </span>{
    <span class="hljs-comment">// on récupère les données pour cette vue en fonction de la requête.</span>
    <span class="hljs-keyword">var</span> data = getViewData(req);

    <span class="hljs-comment">// on génère la soupe au tag avec nos données dedans</span>
    <span class="hljs-keyword">var</span> markup = React.renderToString(React.createElement(Handler), data);

    <span class="hljs-comment">// on utilise React comme moteur de template</span>
    <span class="hljs-keyword">var</span> HtmlElement = React.createElement(Html, {markup: markup});  
    res.send(<span class="hljs-string">"&lt;!DOCTYPE html&gt;"</span> +  React.renderToStaticMarkup(HtmlElement));
  });
}
</code></pre>
<p>Et voici le composant <code>Html.jsx</code> que l’on utilise comme <em>template</em> pour notre page principale.</p>
<pre><code class="lang-jsx"><span class="xml">var React = require('react');

var Html = React.createClass({
  render: function() {
    return (
      <span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charSet</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">meta</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Mon site perso<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/app.js"</span> /&gt;</span><span class="javascript">
        &lt;<span class="hljs-regexp">/head&gt;
        &lt;body&gt;
          &lt;div id="react-app" dangerouslySetInnerHTML=</span></span></span><span class="hljs-expression">{{__<span class="hljs-variable">html</span>: <span class="hljs-variable">this.props.markup</span>}}</span><span class="xml"><span class="javascript"> /&gt;
        <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
    );
  }

});

module.exports = Html;</span></span></span>
</code></pre>
<p>Une fois que le code HTML a été généré via<code>React.renderToString(React.createElement(Handler), data);</code>, 
on pourrait utiliser n’importe quel moteur de template (lodash.template, handlebars, ejs, jade, PHP…) 
pour générer le HTML de la page à renvoyer. Dans un souci de rationalisation des outils, 
j’ai préféré utiliser React. </p>
<p>Vous avez dû vous apercevoir qu’on utilise 2 méthodes différentes pour générer 
du HTML avec React&nbsp;:</p>
<ul>
<li><code>React.renderToString(React.createElement(Handler), data);</code></li>
<li><code>React.renderToStaticMarkup(React.createElement(Handler), data);</code></li>
</ul>
<p>La différence entre les deux méthodes est simple. Dans la première, React annote 
les nœuds HTML avec des <code>data-reactid</code> dans le but de pouvoir ensuite reprendre 
la main lorsque votre l’application s’exécutera dans le navigateur. De cette manière, 
React sait que vous l’initialisez avec un contenu généré depuis le serveur. 
Et si il détecte une différence entre le code existant et celui qu’il génère, 
vous aurez droit à un <a href="https://github.com/facebook/react/blob/2aeb8a2a6beb00617a4217f7f8284924fa2ad819/src/browser/ui/__tests__/ReactRenderDocument-test.js#L205-L215">petit warning</a>. 
La deuxième méthode permet de générer du code HTML sans annotations, 
comme n’importe quel moteur de <em>template</em>.</p>
<p>Les plus attentifs auront remarqué qu’on passe les données initiales lors de 
la création de l’application via des <em>props</em> React. Quid de l’utilisation 
de flux dans tout ça ?</p>
<h2 id="flux-et-le-rendu-serveur"><a class="putainde-Title-anchor" href="#flux-et-le-rendu-serveur">#</a>Flux et le rendu serveur</h2><p>Avec <a href="http://facebook.github.io/flux/">Flux</a>, ce sont les stores qui maintiennent 
l’état de notre application. Si l’on ne veut pas afficher notre application 
sans aucune données, nous allons devoir préalablement peupler nos stores 
avant d’appeler <code>React.renderToString()</code>. </p>
<p>Là où ça se corse un peu, c’est qu’il va falloir remplir nos stores avant de démarrer 
notre application sous peine de voir le message d’alerte dont je parlais plus haut. 
Le plus simple alors est de passer ces données au moteur de template, 
en plus du markup (par exemple sous la forme d’un nœud <code>&lt;script type=&quot;application/json&quot;&gt;JSON DATA&lt;/script&gt;</code>.
Il ne reste plus qu’a récupérer ces données avant d’appeler <code>React.render( Application, document.getElementById(&quot;react-app&quot;))</code></p>
<p>Par exemple&nbsp;: </p>
<pre><code class="lang-javascript">document.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> </span>{
  <span class="hljs-comment">// getData() va récuperer et parser le contenu du tag script </span>
  <span class="hljs-comment">// qui contient nos données</span>
  <span class="hljs-keyword">var</span> storeData= getData(); 

  <span class="hljs-comment">// on déclenche une actions</span>
  actions.init( storeData);

  <span class="hljs-comment">// on lance le rendu</span>
  React.render(&lt;App /&gt;, document.getElementById(<span class="hljs-string">"react-app"</span>));
});
</code></pre>
<h2 id="le-mot-de-la-fin"><a class="putainde-Title-anchor" href="#le-mot-de-la-fin">#</a>Le mot de la fin</h2><p>Penser son application React pour qu’elle puisse être rendue coté serveur 
introduit de nouvelles problématiques, notamment avec l’ajout du <em>pattern</em> Flux. 
En fonction des pages que l’on souhaite afficher, on devra initialiser différents <em>stores</em>. 
À nous de déterminer, en fonction de l’URL et du composant à afficher, 
lequel initialiser, et cela, que l’on soit sur le client ou le serveur. 
De la même manière, il faudra être capable de charger nos données, indépendamment 
de l’environnement d’exécution (coucou XHR).</p>
<p>Un début de réponse se trouve dans les exemples fournis avec react-router. 
L’idée est de passer par une propriété <code>statics</code> lors de la création des composants React 
qui seront associés à une <code>&lt;Route/&gt;</code>.</p>
<pre><code class="lang-jsx">
var ProjectPage = React.createClass({ 
  statics: {
    fetchData: <span class="hljs-keyword">function</span>(params){
      <span class="hljs-keyword">return</span> api.getPageData(params.url)
        .then( actions.initProject)
        .catch( actions.loadProjectError);
    }
  }
 <span class="hljs-keyword">...</span>
 });
</code></pre>
<p>Dans ce bloc <code>statics</code>, on définit une fonction qui servira à récupérer les données 
pour ce composant mais on pourrait très bien imaginer retourner la liste d’actions 
à lancer ou encore les <em>stores</em> à initialiser voire même un descripteur des données nécessaires 
à la vue (<a href="https://www.youtube.com/watch?v=9sc8Pyc51uU">cf Relay / GraphQL</a>) </p>
<p>Ensuite, lorsque le callback fourni à <code>Router.run()</code> est appelé, il suffit de parcourir 
les <em>Handler</em> pour récupérer les informations contenues dans les blocs <code>statics</code>, 
les traiter et enfin faire <code>React.render()</code>.</p>
<pre><code class="lang-Javascript"><span class="hljs-comment">// On renvoie une promesse qui sera résolue lorsque que toutes les données démandées via fetchData seront reçues.</span>
Router.run(routes, Router.HistoryLocation, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(Handler, state)</span> </span>{
  <span class="hljs-keyword">var</span> p = Promise.all(state.routes
    .filter(route =&gt; route.handler.fetchData)  <span class="hljs-comment">// définit fetchData</span>
    .map(route =&gt; {
      <span class="hljs-keyword">return</span> route.handler.fetchData(state.params);
    })
  );
  p.then( x =&gt; {
    React.render(&lt;Handler {...state} /&gt;, document.getElementById(<span class="hljs-string">"react-app"</span>))
  });
});
</code></pre>
<p>Le principe est simple et peut être facilement encapsulé dans un module pour 
être partagé entre le client et le serveur.  J’espère que cet article vous a permis 
d’appréhender un peu mieux le rendu coté serveur d’une application React. 
N’hésitez pas à laisser des commentaires si vous avez des questions où 
si vous souhaitez partager vos expériences dans ce domaine. </p>
<p>Et quelques liens vidéo des sessions de la #reactjsconf :</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=XZfvW1a8Xac">React.js Conf 2015 - react-router increases your productivity </a> </li>
<li><a href="https://www.youtube.com/watch?v=z5e7kWSHWTg">React.js Conf 2015 - Hype!</a> : un aperçu des possibilités de react-router</li>
</ul>
</div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="Grid"><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/edit/master/src/pages/posts/js/reactjs-et-rendu-serverside/index.md" class="putainde-Post-footer-action">Modifier</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/blame/master/src/pages/posts/js/reactjs-et-rendu-serverside/index.md" class="putainde-Post-footer-action">Tracer les changements</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/commits/master/src/pages/posts/js/reactjs-et-rendu-serverside/index.md" class="putainde-Post-footer-action">Historique</a></div></div></footer><div class="putainde-Author"><a href="http://lumographe.fr/" class="putainde-Avatar putainde-Author-picture"><img src="https://avatars.githubusercontent.com/u/160320?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par</span> <a href="http://lumographe.fr/" class="putainde-Link">lionelB</a></h3><div class="putainde-Author-social"><a href="http://lumographe.fr/" data-cssr-tooltip="Website" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-home"><use xlink:href="#putainde-Icon-home"></use></svg></a><a href="https://twitter.com/b_lionel" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a><a href="https://github.com/lionelB" data-cssr-tooltip="Github" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></div></div><p class="putainde-Author-bio">Développeur front-end indépendant et un peu bricoleur, les mains blanches, dans le plâtre dès la maternelle, les mains noires, dans le cambouis du vélo très vite après, les mains propres depuis, dans le code informatique… <br> Et quand il code pas, il rêve à son prochain voyage en vélo.</p></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">2 contributeurs</strong><div data-cssr-tooltip="lionelB" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://lumographe.fr/" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/160320?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div><div data-cssr-tooltip="Macxim" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="https://github.com/Macxim" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/1909957?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div></div><div id="disqus_thread" aria-live="polite"><noscript>| Please enable JavaScript to view the
a(href="http://disqus.com/?ref_noscript") comments powered by Disqus.</noscript></div></div></article></div><div class="putainde-Footer"><div class="Grid"><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text">© 1970 - 2015 Putain de code !</p></div><div class="Grid-cell u-size6of12"><ul class="putainde-Footer-list"><li><a href="../../../feed.xml">Flux RSS</a></li><li><a href="../../../projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><li><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></li><li><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></li></ul></div><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎</p></div></div></div><script>var disqus_shortname = "putaindecode";var disqus_identifier = "http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/";
var disqus_url = "http://putaindecode.fr/posts/js/reactjs-et-rendu-serverside/";
var disqus_script = "embed.js";;(function(d,s) {
s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
(d.getElementsByTagName('head')[0]).appendChild(s)
})(document)</script><script src="../../../scripts/index.js"></script><script>var _gaq=[['_setAccount','UA-43771806-1'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src='//www.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>