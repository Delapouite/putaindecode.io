<!DOCTYPE html><html lang="fr" class="cssr-VerticalRhythm"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui"><title>JavaScript modulaire pour le front-end : les bases</title><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@putaindecode"/><meta name="twitter:title" content="JavaScript modulaire pour le front-end : les bases"/><meta name="twitter:creator" content="@syvuilliot"/><meta property="og:title" content="JavaScript modulaire pour le front-end : les bases"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Putain de code !"/><link rel="stylesheet" href="../../../stylesheets/index.css"><link rel="alternate" href="../../../feed.xml" title="Putain de code !" type="application/atom+xml"></head><body><svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="putainde-Icon-bookmark" viewBox="0 0 512 512">
      <title>bookmark icon</title>
      <path d="M318.275 90v283.23L256 318.16l-62.275 55.07V90h124.55m40-40h-204.55v412L256 371.557 358.275 462V50z"/>
    </symbol>

    <symbol id="putainde-Icon-github" viewBox="0 0 512 512">
      <title>github icon</title>
      <path d="M461.633 250.645l.367-3.82c-22.896-2.22-45.667-2.418-67.79-.73 3.557-11.346 5.43-24.163 5.295-38.738-.292-30.965-10.616-55.08-26.843-75.096 3.116-18.85.77-37.7-5.11-56.56-23.188 1.898-44.054 9.493-62.635 22.686-34.725-7.044-69.447-7.493-104.172 0-21.673-14.627-42.956-21.802-63.91-22.686-6.21 20.765-7.168 41.233-1.916 61.357-18.28 19.397-25.27 42.944-24.926 69.02.196 14.926 2.496 28.208 6.738 39.95-21.796-1.598-44.2-1.385-66.732.8l.367 3.818c22.947-2.228 45.76-2.41 67.92-.678.813 1.974 1.632 3.94 2.566 5.815-24.01-.633-45.618 1.453-65.854 6.43l.913 3.723c20.538-5.048 42.54-7.08 67.107-6.254 16.246 28.865 47.52 45.825 93.063 51.206-10.58 8.594-16.27 18.73-17.735 30.2h-24.12c-32.395 0-41.227-41.303-74.78-37.228C132 320 125.5 371.598 177.588 371.598h21.88v47.297c.234 7.643-3.093 12.754-8.47 16.297 18.655 1.884 32.675-7.43 32.675-18.854V353.82l5.833-6v72.992c.245 7.265-3.284 11.392-7.03 15.34 16.433.653 31.89-2.63 32.59-16.616V349.68s5.757-3.6 5.757 0v66.58c.17 11.8 10.36 21.366 31.953 19.892-5.776-4.65-7.55-9.35-7.55-16.15v-72.18s5.95-.307 5.95 6v60.88c0 13.55 16.268 19.14 34.83 18.615-6.08-4.558-10.196-9.99-10.223-17.256v-73.216c-.63-10.762-5.003-20.906-13.582-30.358 41.63-6.392 71.638-23.01 86.58-52.796 24.646-.847 46.714 1.183 67.306 6.246l.914-3.723c-20.394-5.014-42.18-7.096-66.416-6.415.84-1.89 1.67-3.79 2.39-5.785 22.39-1.798 45.457-1.622 68.66.632zM114 310.023c-1.023 0-1.853-.588-1.853-1.313 0-.728.83-1.315 1.853-1.315 1.024 0 1.854.588 1.854 1.315 0 .726-.83 1.313-1.854 1.313zm5.833 3.98c-1.137 0-2.06-.653-2.06-1.46s.923-1.462 2.06-1.462 2.06.656 2.06 1.463-.923 1.46-2.06 1.46zm5.917 5.17c-1.333 0-2.415-.767-2.415-1.713s1.082-1.714 2.415-1.714 2.416.768 2.416 1.714-1.083 1.712-2.416 1.712zm5.75 6.206c-1.56 0-2.825-.897-2.825-2.004s1.265-2.005 2.825-2.005 2.825.9 2.825 2.006-1.265 2.003-2.825 2.003zm6.333 7.014c-1.733 0-3.14-.996-3.14-2.226s1.407-2.228 3.14-2.228 3.14.998 3.14 2.228-1.407 2.226-3.14 2.226zm7.334 7.123c-1.926 0-3.488-1.107-3.488-2.474s1.56-2.476 3.487-2.476c1.925 0 3.487 1.11 3.487 2.476s-1.562 2.474-3.487 2.474zm9.916 6.774c-2.14 0-3.875-1.23-3.875-2.748 0-1.52 1.735-2.75 3.875-2.75s3.875 1.23 3.875 2.75c0 1.518-1.735 2.75-3.875 2.75zm12.292 3.626c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.958.417c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75zm12.792.25c-2.14 0-3.875-1.23-3.875-2.75 0-1.518 1.735-2.75 3.875-2.75s3.875 1.232 3.875 2.75c0 1.52-1.735 2.75-3.875 2.75z"/>
    </symbol>

    <symbol id="putainde-Icon-home" viewBox="0 0 512 512">
      <title>home icon</title>
      <path d="M394.072 174.805l-47.916-48.023v-38.31h47.916v86.333zM462 275.815h-42.508v166.213H92.508V275.815H50L256 69.972l206 205.843zm-165.153-3.843c-15.81-3.316-29.02 4.086-38.792 19.387-9.77-15.302-22.98-22.704-38.79-19.388-36.745 10.876-36.335 69.543 38.583 113.047 75.06-43.26 75.742-102.172 39-113.048z"/>
    </symbol>

    <symbol id="putainde-Icon-pencil" viewBox="0 0 512 512">
      <title>pencil icon</title>
      <path d="M74.686 340.686L50 460.95l122.365-22.585L379.52 231.21l-97.68-97.68L74.686 340.687zm228.402-135.654l-181.89 181.89-21.214-21.213 181.89-181.89 21.214 21.212zM462 148.732l-52.662 52.66-97.682-97.68 52.662-52.662L462 148.73z"/>
    </symbol>

    <symbol id="putainde-Icon-text-file" viewBox="0 0 512 512">
      <title>text-file icon</title>
      <path d="M256 370.312h-84.495v-30H256v30zm83.495-55.416h-167.99v-30h167.99v30zm0-55.334h-167.99v-30h167.99v30zM297.818 90v85.75h85.864V422H128.317V90h169.5m25-40h-234.5v412h335.365V150.75L322.818 50z"/>
    </symbol>

    <symbol id="putainde-Icon-twitter" viewBox="0 0 512 512">
      <title>twitter icon</title>
      <path d="M462 128.223c-15.158 6.724-31.45 11.27-48.547 13.31 17.45-10.46 30.854-27.025 37.164-46.764-16.333 9.686-34.422 16.72-53.676 20.51-15.417-16.428-37.385-26.69-61.697-26.69-54.56 0-94.668 50.915-82.337 103.786-70.25-3.524-132.534-37.177-174.223-88.314-22.142 37.983-11.485 87.69 26.158 112.85-13.853-.438-26.89-4.24-38.284-10.574-.917 39.162 27.146 75.78 67.795 83.95-11.895 3.236-24.925 3.977-38.17 1.446 10.755 33.58 41.973 58.018 78.96 58.7C139.605 378.28 94.847 390.72 50 385.435c37.406 23.982 81.837 37.977 129.57 37.977 156.933 0 245.596-132.55 240.252-251.435 16.517-11.917 30.846-26.804 42.178-43.755z"/>
    </symbol>
</svg><div class="putainde-Header"><div class="Grid"><div class="Grid-cell u-size5of12"><a href="../../.." class="putainde-SiteTitle"><img alt="Putain de code !" src="../../../images/p!-logo.svg" class="putainde-Logo"><span>Putain de code !</span></a></div><div class="Grid-cell u-size7of12"><nav class="putainde-Nav"><a href="../.." data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-bookmark"><use xlink:href="#putainde-Icon-bookmark"></use></svg> Articles</a><a href="../../../c-est-quoi-putaindecode" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-text-file"><use xlink:href="#putainde-Icon-text-file"></use></svg> Readme</a><a href="../../comment-contribuer" data-cssr-tooltip="" class="putainde-Nav-item  "><svg style="" class="putainde-Icon putainde-Icon-pencil"><use xlink:href="#putainde-Icon-pencil"></use></svg> Participer</a><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="putainde-Nav-item  putainde-Nav-item--icon cssr-Tooltip cssr-Tooltip--bottom"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></nav></div></div></div><div class="putainde-Main"><article class="Grid putainde-Post"><div class="Grid-cell u-size8of12 Grid putainde-Post-contents"><div class="putainde-Title"><h1 class="putainde-Title-text">JavaScript modulaire pour le front-end : les bases</h1></div><header class="putainde-Post-header"><div class="putainde-Post-metas">Écrit par <a href="http://kaes.fr">syvuilliot</a>, <span class="putainde-Date"> le 15 déc. 2014</span>. <span data-cssr-tooltip="Temps de lecture approximatif, sur une base de {{wpm}} mots par minute" data-readingTime-wpm="250" class="putainde-Post-readingTime putainde-Post-readingTime--hidden cssr-Tooltip cssr-Tooltip--top">Temps de lecture : environ  <span class="putainde-Post-readingTime-value"></span> minutes</span></div><ul class="putainde-Tags putainde-Post-tags"><li class="putainde-Tag">javascript</li><li class="putainde-Tag">amd</li><li class="putainde-Tag">commonjs</li><li class="putainde-Tag">browserify</li><li class="putainde-Tag">npm</li><li class="putainde-Tag">requirejs</li><li class="putainde-Tag">bower</li></ul></header><div class="putainde-Post-md"><p>Quand on réalise des applications en JS pour les navigateurs web, on ne peut plus se contenter de mettre des tags <code>script</code> dans le bon ordre pour charger les bibliothèques tierces que l’on utilise comme pour un site web. C’est pourquoi il existe des outils pour permettre d’écrire du JavaScript modulaire et réutiliser plus facilement les innombrables bibliothèques publiées par la communauté JS.</p>
<p>Cependant, ce principe d’écriture modulaire et de publication de code n’étant pas intégré dans le langage lui-même, de très nombreuses solutions existent plus ou moins compatibles les unes avec les autres et aboutissant à une forte fragmentation de la communauté.
Donc quand on décide de se mettre au JavaScript modulaire, on trouve tout un tas d’articles (en anglais) parfois trop vieux (“une étape de build n’est pas adaptée au navigateur”), parfois trop subjectifs (“J’aime pas la syntaxe AMD”), parfois confus (“utiliser les modules pour de l’injection de dépendances”), parfois simplistes (“AMD vs CommonJS”).</p>
<p>C’est pourquoi j’ai voulu partager mon expérience, en essayant d’abord de reposer les bases du problème, puis en vous faisant part de ce que j’estime être la solution la plus satisfaisante actuellement.</p>
<p>D’abord, il faut faire la distinction entre 3 aspects du problème :</p>
<ul>
<li>le format d’écriture des modules (“module authoring format”)</li>
<li>le système de gestion des packages (“package management”)</li>
<li>la convention de résolution des dépendances de module</li>
</ul>
<h1 id="format-d-ecriture-des-modules"><a class="putainde-Title-anchor" href="#format-d-ecriture-des-modules">#</a>Format d’écriture des modules</h1><p>Le module est la brique de base pour décomposer un gros fichier JS en plusieurs fichiers plus petits et focalisés sur une fonctionnalité précise. La plupart du temps un module est un fichier JS qui fournit une fonction, un constructeur ou un objet de valeur. Et comme, pour fournir cette fonctionnalité, un module peut avoir besoin d’autres modules, il existe un mécanisme pour déclarer ses dépendances.</p>
<p>Actuellement, 2 standards principaux existent pour écrire ces modules : <strong>AMD</strong> et <strong>CommonJS</strong>.
Il est également possible d’utiliser la <a href="http://www.2ality.com/2014/09/es6-modules-final.html">syntaxe retenue par ES6</a> (qui j’espère va enfin devenir le standard unique) mais pour l’instant, ça demande encore une étape de “transpilation” en AMD ou CJS.</p>
<p>Le format AMD (dans sa forme la plus courante) est :</p>
<pre><code class="lang-js">define([<span class="hljs-string">'moduleA'</span>, <span class="hljs-string">'moduleB'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> </span>{
  <span class="hljs-comment">// j'utilise a et b</span>
  <span class="hljs-keyword">return</span> maFonctionTresUtile;
});
</code></pre>
<p>Le format CommonJS (dans sa forme la plus courante) est :</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moduleA'</span>);
<span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moduleB'</span>);
<span class="hljs-comment">// j'utilise a et b</span>
<span class="hljs-built_in">module</span>.exports = maFonctionTresUtile;
</code></pre>
<p>Ca n’est pas très différent dans l’esprit : tous les 2 permettent de décrire des dépendances et d’exporter une valeur.
La différence principale réside dans le fait que :</p>
<ul>
<li>CommonJS prévoit une évaluation en une passe dans laquelle il faut résoudre les dépendances au fur et à mesure</li>
<li>alors que AMD prévoit une évaluation en 2 passes :<ul>
<li>une première pour récupérer uniquement la liste des dépendances</li>
<li>et une seconde où on exécute le callback (le corps du module) avec les dépendances résolues.
C’est pourquoi on parle de format “synchrone” dans le premier cas et “asynchrone” dans le second car on peut résoudre les dépendances de façon asynchrone en AMD.</li>
</ul>
</li>
</ul>
<p>Dans les 2 cas, par contre, il y a besoin d’une <em>résolution des dépendances</em>, c’est à dire qu’un module ne peut pas être exécuté tel quel dans un navigateur en le chargeant via un tag <code>script</code>. Non, il faut un <em>loader</em>, c’est à dire un outil qui va charger le module qu’on lui demande et va résoudre les dépendances en cascade. Mais contrairement à ce que l’on pourrait croire, les règles de résolution des dépendances n’ont rien à voir avec le format du module (on verra ça plus tard).</p>
<h1 id="package-management"><a class="putainde-Title-anchor" href="#package-management">#</a>Package management</h1><p>Parlons maintenant des packages. En effet, pouvoir découper du code en modules, c’est bien ; mais ce qui est encore mieux c’est de pouvoir le partager avec d’autres pour qu’il soit facilement réutilisable et arrêter le syndrôme de :</p>
<blockquote>
<p>“je recode un event emitter dans ma bibliothèque comme ça je n’ai pas de
dépendance et c’est plus facile à consommer par mes utilisateurs”</p>
</blockquote>
<p> C’est le problème n°1 des bibliothèques front qui présentent souvent comme un argument de ne pas avoir de dépendances. Sauf que, si on y réfléchit, ça veut dire que : soit c’est une bibliothèque très bas niveau, soit le mec a recodé des trucs qui existent déjà au lieu de s’occuper de son sujet principal.</p>
<p>C’est là qu’entre en jeu la notion de <em>package</em> (que je ne traduirai pas en français, car ça ne servirait qu’à apporter de la confusion). Un package est un ensemble de fichiers (pas forcément des fichiers JS d’ailleurs) avec des métadonnées associées pour décrire principalement :</p>
<ul>
<li>où est stocké le package,</li>
<li>qui est l’auteur,</li>
<li>quelle est la licence,</li>
<li>quelle est la version,</li>
<li>et … quelles sont les dépendances et leurs versions !</li>
</ul>
<p>Ici les dépendances sont des dépendances entre packages, <a href="http://fr.slideshare.net/domenicdenicola/client-side-packages">ce qui n’a rien à voir avec les dépendances entre modules</a>.</p>
<p>Pour faciliter l’utilisation des packages, on utilise un <em>package manager</em>, dont le rôle principal est, à partir d’un id de module (et éventuellement d’un numéro de version), de trouver l’adresse où se trouve les fichiers, les télécharger et les installer localement… et ceci de façon récursive pour les dépendances, ce qui est le gros avantage par rapport à le faire à la mano. Mais sinon, ça n’est pas plus compliqué que ça dans le principe, et ça reste valable pour des fichiers JS ou non, front-end ou non.</p>
<p>Les principaux package managers pour le front-end sont <a href="https://www.npmjs.com/">npm</a> et <a href="http://bower.io">bower</a>.
La grande différence entre les deux est que <strong>npm installe les dépendances de façon relative</strong> : pour chaque package, les dépendances sont installées dans un sous-dossier (node_modules).</p>
<ul>
<li>mon-projet-avec-nmp<ul>
<li>app.js</li>
<li>node_modules<ul>
<li>une-dependance<ul>
<li>main.js</li>
<li>nodes_modules<ul>
<li>une-dependance-indirecte<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>une-autre-dependance<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Alors que <strong>bower prend le parti d’installer les dépendances à plat</strong> : le package et ses dépendances et les dépendances des dépendances sont toutes installées au même niveau dans le même dossier.</p>
<ul>
<li>mon-projet-avec-bower<ul>
<li>app.js</li>
<li>bower_components<ul>
<li>une-dependance<ul>
<li>main.js</li>
</ul>
</li>
<li>une-autre-dependance<ul>
<li>main.js</li>
</ul>
</li>
<li>une-dependance-indirecte<ul>
<li>main.js</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>L’approche bower semble être une bonne idée car si 2 packages ont la même dépendance (ou des dépendances compatibles semver), une seule est installée. Alors qu’avec npm chaque package installe sa propre dépendance.</p>
<p>Cependant, s’il y a une incompatibilité de versions :</p>
<blockquote>
<p>le package A déclare une dépendance sur X en version 1
le package B déclare une dépendance sur X mais en version 2</p>
</blockquote>
<p>Avec bower, on est coincé : on ne peut installer qu’une seule version. Lors du <code>bower install</code>, il faudra choisir quelle version on garde : soit A devra utiliser X2, soit B devra utiliser X1.</p>
<ul>
<li>mon-app-avec-bower<ul>
<li>bower_components<ul>
<li>package-A</li>
<li>package-B</li>
<li>package-X<ul>
<li>main.js // v1 ou v2 mais pas les 2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Bower appelle cela de la <em>résolution de conflits</em>. Mais concrêtement, cela veut dire qu’on force une dépendance qui n’est pas supportée officiellement par le package en question. Donc on se retrouve responsable de vérifier que le package B fonctionne correctement avec X1. Pas cool :-(</p>
<p>Alors qu’avec npm les versions des dépendances sont respectées, il n’y a pas de question à se poser.</p>
<ul>
<li>mon-app-avec-npm<ul>
<li>node_modules<ul>
<li>package-A<ul>
<li>node_modules<ul>
<li>package-X<ul>
<li>main.js // v1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>package-B<ul>
<li>node_modules<ul>
<li>package-X<ul>
<li>main.js // v2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="resolution-des-dependances-de-module"><a class="putainde-Title-anchor" href="#resolution-des-dependances-de-module">#</a>Résolution des dépendances de module</h1><p>La question est alors :</p>
<blockquote>
<p>“Pourquoi existe-t-il des package managers spécifiquement pour le web front-end ?”</p>
</blockquote>
<p>Réponse :</p>
<blockquote>
<p> “Pour faciliter l’utilisation de modules publiés dans des packages dans le contexte du front-end”</p>
</blockquote>
<p>Super ! Mais concrêtement ?</p>
<p>Et bien, venons en au coeur du problème : <em>la résolution des module-id en fichier</em>. Comme on l’a vu, pour charger un module dans le navigateur, il faut utiliser un loader. Et une de ses tâches est de <em>résoudre</em> les <code>module_id</code> en adresse de fichier.</p>
<p>Au pire il faudrait explicitement dire au loader pour chaque <code>module_id</code> où est le fichier correspondant. Heureusement, ce n’est pas le cas, ni avec requireJS, ni avec les loaders compatibles npm.</p>
<h2 id="amd"><a class="putainde-Title-anchor" href="#amd">#</a>AMD</h2><p>RequireJS et les autres loaders AMD vont assez loin en  matière de <a href="http://requirejs.org/docs/api.html#config">configuration</a> mais souvent , ça revient à décrire des règles du style <em>tous les modules id qui commencent par <code>mon-package</code> sont à chercher dans le dossier <code>./mon-package</code></em>.</p>
<p>En fait, ça n’est pas tout à fait vrai qu’il faille systématiquement configurer les règles de résolution avec RequireJS : il y a une règle par défaut qui stipule que les module_id sont résolus par rapport à une “baseURL” (qui par défaut est celle du fichier html). Donc si on installe tous les packages au même niveau, ça marche par défaut.
C’est pour cela que bower est souvent utilisé pour les packages front-end en AMD car il installe les fichiers à plat et de cette façon on limite le besoin de configuration.</p>
<h2 id="npm"><a class="putainde-Title-anchor" href="#npm">#</a>NPM</h2><p>A l’opposé de cette approche très flexible, il y a nodeJS avec une <a href="https://github.com/substack/browserify-handbook#how-node_modules-works">convention simple et statique</a>, qui dit en gros :</p>
<ul>
<li>si c’est une référence relative, il suffit de suivre le chemin</li>
<li>si c’est une référence absolue, il faut chercher dans le dossier <code>node_modules</code> et ceci de façon récursive jusqu’à arriver à la racine</li>
</ul>
<p>Et donc zéro config, puisque ça n’est pas configurable. Ca peut paraître être une limitation mais c’est une force.</p>
<h1 id="conclusion"><a class="putainde-Title-anchor" href="#conclusion">#</a>Conclusion</h1><p>Si tous les packages en AMD utilisaient la règle de résolution par défaut et que l’on utilisait bower pour les installer, on n’aurait rien à configurer. Mais dans la pratique, ça n’est pas le cas et on se retrouve à devoir configurer les règles de résolution non seulement pour ses propres dépendances (<em>pourquoi pas</em>) mais également pour les dépendances de ses dépendances (<em>et là ça ne va plus</em>).
Et il reste toujours le problème des conflits de version liés à l’approche de mettre les dépendances à plat.</p>
<p>D’un autre côté, il y a la convention nodeJS qui impose des règles simples, non modifiables et qui n’a pas de problème de conflit de versions. C’est à dire qu’il suffit de faire <code>npm install mon-package</code> et ça marche. Une convention qui fait l’unanimité pour le backend JS.</p>
<p>Côté front, on lui reproche de charger les dépendances sans les dédoublonner et de le faire en synchrone, ce qui n’est pas adapté quand le chargement des fichiers se fait via un réseau en http et pas directement depuis un disque local comme sur un serveur.</p>
<p>C’est pourquoi a été inventé <a href="http://http://browserify.org/">browserify</a> qui apporte actuellement <a href="http://putaindecode.fr/posts/js/browserify-all-the-things/">le meilleur des 2 mondes</a> : toujours zéro config selon la convention nodeJS et un système de bundle/build (via une analyse syntaxique du code JS pour détecter les dépendances) afin d’assembler tous les modules en un seul fichier adapté au navigateur.
On peut lui reprocher la nécessité d’une étape de build et le fait que le code source en débug est en un seul fichier mais :</p>
<ol>
<li>de toute façon pour la prod, il y aura une étape de build et en dév, avec un outillage adapté (par exemple <code>watchify</code> qui rebuild en incrémental) ça n’est pas la mer à boire</li>
<li>avec le support des sources-map dans les navigateurs, on peut maintenant retrouver en debug les mêmes noms de fichiers et les mêmes numéro de ligne que dans les fichiers d’origine et les points d’arrêt fonctionnent.</li>
</ol>
<p>Au final, ça en devient même un avantage, car le code que l’on exécute en dev dans le navigateur est très proche de ce que l’on aura en prod, en tout cas plus proche qu’avec requireJS pour lequel on développe sans build et pour lequel il faut écrire à nouveau une config de build pour la mise en prod.</p>
<h1 id="conclusion-de-la-conclusion"><a class="putainde-Title-anchor" href="#conclusion-de-la-conclusion">#</a>Conclusion de la conclusion</h1><p>Ma conclusion est que le point crucial pour faciliter la réutilisation de modules, c’est de <strong>minimiser les contraintes sur les utilisateurs</strong> et donc de se rapprocher d’un usage <em>plug and play</em>. Pour cela il faut une convention forte entre le package manager et le loader/builder de modules, afin d’éviter à l’utilisateur de devoir écrire des configs … la plupart du temps.
Bien sûr, la recherche du “zéro config” n’est pas une fin et c’est particulièrement vrai côté front où les contraintes de chargement de fichiers sont fortes. Et si vous voulez diviser votre bundle en plusieurs fichiers ou si vous voulez des règles d’optimisation complexes pour votre build, il est normal de devoir mettre les mains dans le cambouis.
Mais si au moins le cas d’usage le plus fréquent (compiler son appli en un seul fichier qui sera chargé via un tag <code>script</code>) est simplifié au maximum, alors on pourra sûrement voir côté front, le même état d’esprit que côté back. Et je suis plutôt optimiste, <a href="https://medium.com/@trek/last-week-i-had-a-small-meltdown-on-twitter-about-npms-future-plans-around-front-end-packaging-b424dd8d367a">contrairement à certains</a>.</p>
<p>Utilisateur de la première heure d’<code>AMD</code> et de <code>Dojo loader</code>, puis de <code>bower</code>, je me suis rendu compte de leurs limites et surtout j’ai été régulièrement gêné par la complexité de la configuration… surtout lorsqu’il fallait passer au build. Cela freine la réutilisation de modules tiers et c’est dommage.
Ce n’est pas un problème intrinsèque au format de module et toutes les discussions sur “moi j’aime / j’aime pas la syntaxe AMD” sont secondaires (d’ailleurs <a href="https://www.npmjs.com/package/deamdify">browserify peut fonctionner avec des bibliothèques en AMD</a>).
Mais dans la pratique, nous migrons vers la solution <code>npm + browserify</code> et c’est vraiment moins compliqué.</p>
<p>J’espère que cet article vous permettra d’y voir plus clair, de dépasser les querelles sur les préférences personnelles de chacun, et de vous aider à faire votre choix.
Je n’estime pas être un expert du sujet, il y a sûrement beaucoup de choses à compléter ou préciser, donc n’hésitez pas à réagir.</p>
<p>Pour aller plus loin et regarder vers le futur que nous amène ES6, il y a cet <a href="https://medium.com/@brianleroux/es6-modules-amd-and-commonjs-c1acefbe6fc0">excellent article</a>.</p>
</div><footer class="putainde-Post-footer"><div class="putainde-Post-footer-title">Action sur cette page</div><div class="Grid"><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/edit/master/src/pages/posts/js/etat-lieux-js-modulaire-front/index.md" class="putainde-Post-footer-action">Modifier</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/blame/master/src/pages/posts/js/etat-lieux-js-modulaire-front/index.md" class="putainde-Post-footer-action">Tracer les changements</a></div><div class="Grid-cell u-size1of3"><a href="http://github.com/putaindecode/putaindecode.fr/commits/master/src/pages/posts/js/etat-lieux-js-modulaire-front/index.md" class="putainde-Post-footer-action">Historique</a></div></div></footer><div class="putainde-Author"><a href="http://kaes.fr" class="putainde-Avatar putainde-Author-picture"><img src="https://avatars.githubusercontent.com/u/1689880?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a><div class="putainde-Author-description"><div class="putainde-Author-title"><h3 class="putainde-Author-name"><span class="putainde-WrittenBy">Écrit par</span> <a href="http://kaes.fr" class="putainde-Link">syvuilliot</a></h3><div class="putainde-Author-social"><a href="http://kaes.fr" data-cssr-tooltip="Website" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-home"><use xlink:href="#putainde-Icon-home"></use></svg></a><a href="https://twitter.com/syvuilliot" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a><a href="https://github.com/syvuilliot" data-cssr-tooltip="Github" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></div></div><p class="putainde-Author-bio">Développeur web front-end et co-fondateur de KaeS <br> Spécialisé dans les applications innovantes à destination des petites entreprises</p></div></div><div class="putainde-Contributors"><strong class="putainde-Contributors-label">2 contributeurs</strong><div data-cssr-tooltip="syvuilliot" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://kaes.fr" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/1689880?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div><div data-cssr-tooltip="kud" class="putainde-Contributor cssr-Tooltip cssr-Tooltip--bottom"><a href="http://kud.io" class="putainde-Avatar putainde-Contributor-avatar"><img src="https://avatars.githubusercontent.com/u/655838?v=3&amp;s=128" alt="" class="js-AnimateLoad"/></a></div></div><div id="disqus_thread" aria-live="polite"><noscript>| Please enable JavaScript to view the
a(href="http://disqus.com/?ref_noscript") comments powered by Disqus.</noscript></div></div></article></div><div class="putainde-Footer"><div class="Grid"><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text">© 1970 - 2015 Putain de code !</p></div><div class="Grid-cell u-size6of12"><ul class="putainde-Footer-list"><li><a href="../../../feed.xml">Flux RSS</a></li><li><a href="../../../projets">Projets</a></li><li><a href="https://github.com/putaindecode/forum/issues">Forum</a></li><li><a href="irc://irc.freenode.net/putaindecode">IRC</a></li><li><a href="https://github.com/putaindecode/" data-cssr-tooltip="GitHub" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-github"><use xlink:href="#putainde-Icon-github"></use></svg></a></li><li><a href="https://twitter.com/putaindecode/" data-cssr-tooltip="Twitter" class="cssr-Tooltip cssr-Tooltip--top"><svg style="" class="putainde-Icon putainde-Icon-twitter"><use xlink:href="#putainde-Icon-twitter"></use></svg></a></li></ul></div><div class="Grid-cell u-size3of12"><p class="putainde-Footer-text putainde-Footer-text--small putainde-Footer-text--right">Made with ♥︎</p></div></div></div><script>var disqus_shortname = "putaindecode";var disqus_identifier = "http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/";
var disqus_url = "http://putaindecode.fr/posts/js/etat-lieux-js-modulaire-front/";
var disqus_script = "embed.js";;(function(d,s) {
s = d.createElement('script');s.async=1;s.src = '//' + disqus_shortname + '.disqus.com/'+disqus_script;
(d.getElementsByTagName('head')[0]).appendChild(s)
})(document)</script><script src="../../../scripts/index.js"></script><script>var _gaq=[['_setAccount','UA-43771806-1'],['_trackPageview']];
(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
g.src='//www.google-analytics.com/ga.js';
s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>